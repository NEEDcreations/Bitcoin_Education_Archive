<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A curated Bitcoin education archive with 146 topics, 8800+ messages, and 3000+ images ‚Äî for the world.">
    <meta name="theme-color" content="#f7931a">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="BTC Archive">
    <link rel="preconnect" href="https://www.gstatic.com" crossorigin>
    <link rel="preload" href="channel_index.js" as="script">

    <!-- Open Graph / Twitter Cards -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://bitcoineducation.quest">
    <meta property="og:title" content="Bitcoin Education Archive">
    <meta property="og:description" content="A curated library of 146 topics, 8,800+ messages, and 3,000+ images ‚Äî Bitcoin education for the world.">
    <meta property="og:image" content="https://bitcoineducation.quest/og-image.png">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Bitcoin Education Archive">
    <meta name="twitter:description" content="A curated library of 146 topics, 8,800+ messages, and 3,000+ images ‚Äî Bitcoin education for the world.">
    <meta name="twitter:image" content="https://bitcoineducation.quest/og-image.png">

    <title>Bitcoin Education Archive</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html, body { overflow-x: hidden; scroll-behavior: smooth; }
        img { max-width: 100%; height: auto; }
        
        /* Smooth page load */
        body { opacity: 0; animation: bodyFadeIn 0.4s ease-out 0.1s forwards; }
        @keyframes bodyFadeIn { to { opacity: 1; } }
        
        /* Theme Variables */
        :root {
            --bg: #020617; --bg-side: #0f172a; --border: #1e293b;
            --text: #e2e8f0; --text-dim: #94a3b8; --text-muted: #64748b; --text-faint: #475569;
            --accent: #f97316; --accent-bg: rgba(249,115,22,0.15); --accent-glow: rgba(249,115,22,0.3);
            --heading: #fff; --link: #38bdf8;
            --input-bg: #020617; --msg-border: rgba(255,255,255,0.03);
            --card-bg: rgba(255,255,255,0.03); --overlay: rgba(0,0,0,0.92);
        }
        [data-theme="light"] {
            --bg: #f8fafc; --bg-side: #ffffff; --border: #e2e8f0;
            --text: #1e293b; --text-dim: #475569; --text-muted: #64748b; --text-faint: #94a3b8;
            --accent: #ea580c; --accent-bg: rgba(234,88,12,0.1); --accent-glow: rgba(234,88,12,0.2);
            --heading: #0f172a; --link: #2563eb;
            --input-bg: #f1f5f9; --msg-border: rgba(0,0,0,0.06);
            --card-bg: rgba(0,0,0,0.03); --overlay: rgba(255,255,255,0.95);
        }

        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; display: flex; height: 100vh; overflow: hidden; transition: background 0.3s, color 0.3s; }
        
        /* Theme Toggle */
        .theme-toggle { background: none; border: 1px solid var(--border); color: var(--text-dim); width: 36px; height: 36px; border-radius: 8px; cursor: pointer; font-size: 1.1rem; display: flex; align-items: center; justify-content: center; transition: 0.2s; flex-shrink: 0; margin-left: 10px; }
        .theme-toggle:hover { border-color: var(--accent); color: var(--accent); }

        /* Sidebar */
        aside { width: 320px; background: var(--bg-side); border-right: 1px solid var(--border); display: flex; flex-direction: column; flex-shrink: 0; transition: background 0.3s; }
        .sidebar-header { padding: 24px 20px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; }
        .sidebar-header h2 { color: var(--accent); font-size: 1rem; text-transform: uppercase; letter-spacing: 1.5px; font-weight: 900; line-height: 1.3; }
        .sidebar-header p { color: var(--text-muted); font-size: 0.75rem; margin-top: 4px; }
        .channels { flex: 1; overflow-y: auto; padding: 12px; }
        .search-box { padding: 12px; border-bottom: 1px solid var(--border); }
        .search-input { width: 100%; padding: 10px 14px; background: var(--input-bg); border: 1px solid var(--border); border-radius: 8px; color: var(--text); font-size: 0.9rem; font-family: inherit; outline: none; }
        .search-input:focus { border-color: var(--accent); }
        .random-btn { background: var(--input-bg); border: 1px solid var(--border); border-radius: 8px; font-size: 1.2rem; width: 44px; cursor: pointer; transition: 0.2s; }
        .random-btn:hover { border-color: var(--accent); transform: rotate(15deg); }
        .mobile-close { position: absolute; top: 16px; right: 16px; background: var(--bg-side); border: 1px solid var(--border); color: var(--text-dim); font-size: 1.2rem; cursor: pointer; z-index: 101; line-height: 1; width: 40px; height: 40px; border-radius: 8px; display: none; align-items: center; justify-content: center; }
        .search-input::placeholder { color: var(--text-faint); }
        .search-results { padding: 12px; display: none; overflow-y: auto; flex: 1; background: var(--bg-side); }
        .search-results.active { display: block; }
        .sr-item { padding: 10px 14px; border-radius: 8px; cursor: pointer; color: var(--text-dim); font-size: 0.9rem; margin-bottom: 4px; border-left: 3px solid transparent; transition: 0.15s; }
        .sr-item:hover, .sr-item:active { background: var(--accent-bg); color: var(--heading); border-left-color: var(--accent); }
        .sr-item .sr-cat { font-size: 0.65rem; color: var(--text-faint); text-transform: uppercase; letter-spacing: 1px; }
        .sr-item .sr-match { color: var(--accent); font-size: 0.8rem; margin-top: 4px; line-height: 1.4; }
        .cat-label { font-size: 0.65rem; text-transform: uppercase; color: var(--text-faint); letter-spacing: 2px; margin: 20px 0 8px 12px; font-weight: 800; }
        .cat-toggle { cursor: pointer; display: flex; align-items: center; justify-content: space-between; padding-right: 12px; transition: color 0.2s; user-select: none; }
        .cat-toggle:hover { color: var(--accent); }
        .cat-arrow { font-size: 0.55rem; transition: transform 0.2s; }
        .cat-group { overflow: hidden; transition: max-height 0.3s ease; }
        .ch-btn { display: block; width: 100%; text-align: left; background: none; border: none; color: var(--text-dim); padding: 11px 14px; border-radius: 8px; cursor: pointer; transition: 0.2s; font-size: 0.9rem; font-family: inherit; position: relative; }
        .ch-btn:hover { background: var(--card-bg); color: var(--text); transform: translateX(2px); }
        .ch-btn.active { background: var(--accent-bg); color: var(--accent); font-weight: 700; border-left: 3px solid var(--accent); }
        .ch-btn.visited::after { content: " ‚úì"; color: #22c55e; font-size: 0.75rem; font-weight: 800; }
        .ch-btn::before { content: "# "; color: var(--text-faint); font-weight: 700; }
        .ch-btn:active { transform: scale(0.98); }
        
        /* Main */
        main { flex: 1; overflow-y: auto; }
        
        /* Smooth page transitions */
        @keyframes fadeSlideIn { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes spin { to { transform: rotate(360deg); } }
        .fade-in { animation: fadeSlideIn 0.35s ease-out; }

        .hero { padding: 80px 60px 40px; max-width: 1300px; margin: 0 auto; }
        .hero .cat { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 2px; color: var(--accent); font-weight: 800; margin-bottom: 12px; }
        .hero h1 { font-size: 2.4rem; font-weight: 900; color: var(--heading); letter-spacing: -0.5px; line-height: 1.25; margin-bottom: 16px; }
        .hero .desc { color: var(--text-muted); font-size: 1rem; border-bottom: 1px solid var(--border); padding-bottom: 30px; margin-bottom: 0; }
        
        /* Messages */
        .messages { max-width: 1300px; margin: 0 auto; padding: 0 60px 80px; overflow-x: hidden; }
        .msg { padding: 20px 0; border-bottom: 1px solid var(--msg-border); }
        .msg-text { color: var(--text); font-size: 1.05rem; line-height: 1.8; white-space: pre-wrap; word-wrap: break-word; overflow-wrap: break-word; word-break: break-word; max-width: 100%; }
        .msg-text strong, .msg-text b { color: var(--heading); }
        .tw-preview { margin: 12px 0; padding: 16px 20px; background: linear-gradient(135deg, rgba(29,155,240,0.08), rgba(247,147,26,0.08)); border: 1px solid rgba(29,155,240,0.3); border-radius: 12px; cursor: pointer; transition: 0.3s; position: relative; display: flex; align-items: center; gap: 14px; }
        .tw-preview:hover { border-color: #1d9bf0; box-shadow: 0 0 20px rgba(29,155,240,0.2); transform: translateY(-1px); }
        .tw-preview-icon { font-size: 1.8rem; flex-shrink: 0; }
        .tw-preview-content { flex: 1; min-width: 0; }
        .tw-preview-url { color: var(--text); font-size: 0.9rem; font-weight: 600; word-break: break-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .tw-preview-hint { color: #1d9bf0; font-size: 0.85rem; margin-top: 4px; font-weight: 600; }
        .tw-preview-arrow { color: #1d9bf0; font-size: 1.2rem; flex-shrink: 0; transition: 0.2s; }
        .tw-preview:hover .tw-preview-arrow { transform: translateX(3px); }
        .tw-load-btn { display: none; }
        .tw-embedded { border: 1px solid var(--border); border-radius: 12px; padding: 16px; margin: 8px 0; background: var(--card-bg); }
        .tw-embedded .tw-header { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; font-size: 0.8rem; color: var(--text-faint); }
        .tw-embedded .tw-body { color: var(--text); font-size: 0.95rem; line-height: 1.6; }
        .tw-embedded .tw-footer { margin-top: 8px; font-size: 0.75rem; color: var(--text-faint); }
        .tw-loading { color: var(--text-faint); font-size: 0.85rem; padding: 12px; }
        .yt-embed { position: relative; width: 100%; max-width: 560px; padding-bottom: min(315px, 56.25%); height: 0; overflow: hidden; border-radius: 12px; margin: 12px 0; }
        .yt-embed iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border-radius: 12px; }
        .orange-glow { color: #f7931a; font-weight: 700; font-size: 1.1em; text-shadow: 0 0 20px rgba(247,147,26,0.4); padding: 16px 20px; margin-top: 8px; background: rgba(247,147,26,0.08); border: 1px solid rgba(247,147,26,0.25); border-radius: 12px; display: block; }
        .msg-img { max-width: 100%; border-radius: 12px; margin-top: 14px; border: 1px solid var(--border); cursor: pointer; transition: 0.2s; }
        .msg-img:hover { border-color: var(--accent); box-shadow: 0 8px 30px var(--accent-glow); }
        .msg-link { color: var(--link); text-decoration: none; word-break: break-all; }
        .msg-link:hover { text-decoration: underline; }
        /* Back to top */
        .back-to-top { position: fixed; bottom: 82px; right: 190px; width: 44px; height: 44px; border-radius: 50%; background: var(--accent); color: #fff; border: none; font-size: 1.3rem; cursor: pointer; z-index: 50; opacity: 0; transform: translateY(10px); transition: 0.3s; pointer-events: none; box-shadow: 0 4px 15px var(--accent-glow); }
        .back-to-top.visible { opacity: 1; transform: translateY(0); pointer-events: auto; }
        .back-to-top:hover { transform: translateY(-3px); box-shadow: 0 8px 25px var(--accent-glow); }
        .scroll-to-bottom { bottom: 30px; right: 190px; }

        /* Reading progress bar */
        .progress-bar { position: fixed; top: 0; left: 0; width: 0%; height: 3px; background: linear-gradient(90deg, #eab308, #f97316); z-index: 300; transition: width 0.15s; pointer-events: none; }
        @media (max-width: 900px) { .progress-bar { top: 52px; } }

        /* Share buttons */
        .share-bar { display: flex; gap: 8px; margin-top: 16px; flex-wrap: wrap; }
        .share-btn { display: inline-flex; align-items: center; gap: 6px; padding: 8px 14px; border-radius: 8px; font-size: 0.8rem; font-weight: 600; text-decoration: none; cursor: pointer; border: 1px solid var(--border); background: var(--card-bg); color: var(--text-dim); font-family: inherit; transition: 0.2s; }
        .share-btn:hover { border-color: var(--accent); color: var(--accent); }
        .share-btn.copied { background: var(--accent); color: #fff; border-color: var(--accent); }

        /* Image gallery mode */
        .gallery-toggle { display: none; padding: 8px 14px; border-radius: 8px; border: 1px solid var(--border); background: var(--card-bg); color: var(--text-dim); font-size: 0.8rem; font-weight: 600; cursor: pointer; font-family: inherit; transition: 0.2s; margin-top: 12px; }
        .gallery-toggle:hover { border-color: var(--accent); color: var(--accent); }
        .gallery-toggle.active { background: var(--accent-bg); border-color: var(--accent); color: var(--accent); }
        .gallery-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 8px; padding: 20px 0; }
        @media (max-width: 900px) { .gallery-grid { grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); gap: 6px; } }
        .gallery-grid img { width: 100%; aspect-ratio: 1; object-fit: cover; border-radius: 8px; cursor: pointer; border: 1px solid var(--border); transition: 0.2s; }
        .gallery-grid img:hover { border-color: var(--accent); transform: scale(1.03); box-shadow: 0 4px 15px var(--accent-glow); }

        .load-more-btn { display: block; width: 100%; padding: 16px; margin: 30px 0; background: var(--accent-bg); border: 1px solid var(--accent-glow); border-radius: 12px; color: var(--accent); font-size: 1rem; font-weight: 700; cursor: pointer; font-family: inherit; transition: 0.2s; }
        .load-more-btn:hover { background: var(--accent-glow); }
        .msg-img { content-visibility: auto; }
        
        /* Sidebar Promo */
        .quest-start-btn { display: block; width: calc(100% - 24px); margin: 8px 12px; padding: 10px; background: var(--accent-bg); border: 1px solid var(--accent-glow); border-radius: 8px; color: var(--accent); font-size: 0.85rem; font-weight: 700; cursor: pointer; font-family: inherit; transition: 0.2s; text-align: center; }
        .quest-start-btn:hover { background: var(--accent); color: #fff; }

        .sidebar-promo { display: block; text-align: left; padding: 12px; color: var(--text-faint); font-size: 0.8rem; text-decoration: none; border-top: 1px solid var(--border); transition: 0.2s; letter-spacing: 0.5px; }
        .sidebar-promo:hover { color: var(--accent); background: var(--accent-bg); }

        /* Ranking Bar */
        #rankBar { display: none; flex-direction: column; padding: 12px 20px; border-top: 1px solid var(--border); background: var(--bg); cursor: pointer; }
        .rank-info { display: flex; align-items: center; gap: 10px; }
        .rank-level { font-weight: 800; font-size: 0.9rem; color: var(--accent); }
        .rank-user { color: var(--text-dim); font-size: 0.85rem; }
        .rank-pts { margin-left: auto; color: var(--accent); font-weight: 700; font-size: 0.85rem; }
        .rank-progress { height: 4px; background: var(--border); border-radius: 4px; margin-top: 8px; overflow: hidden; }
        .rank-progress-fill { height: 100%; background: linear-gradient(90deg, #f97316, #eab308); border-radius: 4px; transition: width 0.5s; }
        .rank-next { font-size: 0.7rem; color: var(--text-faint); margin-top: 4px; }

        /* Toasts */
        .rank-toast { position: fixed; bottom: 30px; right: 30px; background: #f97316; color: #fff; padding: 12px 20px; border-radius: 10px; font-size: 0.9rem; font-weight: 700; z-index: 300; opacity: 0; transform: translateY(20px); transition: 0.3s; pointer-events: none; box-shadow: 0 8px 25px rgba(249,115,22,0.3); }
        .rank-toast.show { opacity: 1; transform: translateY(0); }

        /* Leaderboard */
        #leaderboard { display: none; position: fixed; right: 20px; bottom: 20px; width: 340px; max-height: 70vh; background: var(--bg-side); border: 1px solid var(--border); border-radius: 16px; z-index: 150; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.5); transition: 0.3s; }
        #leaderboard.open { display: block; animation: fadeSlideIn 0.3s ease-out; }
        #leaderboard.minimized { max-height: 48px; overflow: hidden; border-radius: 24px; width: auto; cursor: pointer; }
        .lb-min-bar { display: none; padding: 12px 18px; font-size: 0.85rem; font-weight: 700; color: var(--accent); text-align: center; }
        #leaderboard.minimized .lb-min-bar { display: block; }
        #leaderboard.minimized .lb-header, #leaderboard.minimized .lb-list, #leaderboard.minimized .lb-levels { display: none; }
        @media (max-width: 900px) { #leaderboard { right: 10px; left: 10px; bottom: 10px; width: auto; } }
        .lb-header { display: flex; justify-content: space-between; align-items: center; padding: 16px 20px; border-bottom: 1px solid var(--border); }
        .lb-header h3 { color: var(--heading); font-size: 1.1rem; }
        .lb-header div { display: flex; align-items: center; }
        .lb-close { background: none; border: 1px solid var(--border); color: var(--text-dim); font-size: 1.1rem; cursor: pointer; width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; transition: 0.2s; }
        .lb-close:hover { border-color: var(--accent); color: var(--accent); }
        .lb-list { padding: 8px; }
        .lb-row { display: flex; align-items: center; gap: 10px; padding: 10px 12px; border-radius: 8px; }
        .lb-row:hover { background: var(--card-bg); }
        .lb-me { background: var(--accent-bg); border: 1px solid var(--accent-glow); }
        .lb-rank { font-size: 0.9rem; min-width: 30px; color: var(--text-muted); }
        .lb-name { color: var(--text); font-size: 0.9rem; flex: 1; }
        .lb-score { color: var(--accent); font-weight: 700; font-size: 0.85rem; }
        .lb-levels { padding: 12px 20px; border-top: 1px solid var(--border); }
        .lb-levels h4 { color: var(--text-faint); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; }
        .lb-level-row { display: flex; justify-content: space-between; padding: 4px 0; color: var(--text-muted); font-size: 0.8rem; }

        /* Username Modal */
        #usernameModal { display: none; position: fixed; inset: 0; background: var(--overlay); z-index: 250; justify-content: center; align-items: center; }
        #usernameModal.open { display: flex; }
        .username-box { background: var(--bg-side); border: 1px solid var(--border); border-radius: 20px; padding: 40px; max-width: 400px; width: 90%; text-align: center; max-height: 90vh; overflow-y: auto; }
        @media (max-width: 900px) { .username-box { padding: 24px 20px; width: 95%; max-height: 85vh; } }
        .username-box h2 { color: #fff; margin-bottom: 8px; font-size: 1.5rem; }
        .username-box p { color: #64748b; margin-bottom: 24px; font-size: 0.95rem; }
        .username-box input { width: 100%; padding: 14px 18px; background: #020617; border: 1px solid var(--border); border-radius: 10px; color: #fff; font-size: 1rem; font-family: inherit; outline: none; margin-bottom: 16px; text-align: center; }
        .username-box input:focus { border-color: var(--accent); }
        .username-box button { background: #f97316; color: #fff; border: none; padding: 14px 30px; border-radius: 10px; font-size: 1rem; font-weight: 700; cursor: pointer; font-family: inherit; width: 100%; }
        .username-box button:hover { background: #ea580c; }
        .username-box .skip { color: #475569; font-size: 0.85rem; margin-top: 12px; cursor: pointer; display: block; }
        .username-box .skip:hover { color: var(--text-dim); }

        @media (max-width: 900px) {
            #leaderboard { right: 10px; left: 10px; bottom: 70px; width: auto; }
            #lbFloatBtn { bottom: 70px !important; right: 16px !important; padding: 10px 14px !important; font-size: 0.85rem !important; z-index: 140; }
            #floatingRandomBtn { bottom: 130px !important; right: auto !important; left: 50% !important; transform: translateX(-50%) !important; }
            #userDisplay { top: auto !important; bottom: 56px !important; right: auto !important; left: 16px !important; font-size: 0.75rem !important; padding: 6px 10px !important; }
            .rank-toast { right: 15px; bottom: 80px; font-size: 0.8rem; }
        }

        /* Badge Toast */
        .badge-toast { position: fixed; bottom: 30px; left: 30px; display: flex; gap: 14px; align-items: center; background: var(--bg-side); border: 1px solid #22c55e; padding: 16px 20px; border-radius: 14px; z-index: 300; opacity: 0; transform: translateY(20px); transition: 0.4s; box-shadow: 0 8px 30px rgba(34,197,94,0.2); }
        .badge-toast.show { opacity: 1; transform: translateY(0); }
        .badge-toast-emoji { font-size: 2rem; }
        .badge-toast-title { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1px; color: #22c55e; font-weight: 800; }
        .badge-toast-name { color: var(--heading); font-weight: 700; font-size: 1rem; }
        .badge-toast-desc { color: var(--text-muted); font-size: 0.8rem; }

        /* Badges Grid */
        .badges-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(90px, 1fr)); gap: 10px; padding: 12px; }
        .badge-item { text-align: center; padding: 12px 6px; border-radius: 12px; border: 1px solid var(--border); background: var(--card-bg); transition: 0.2s; position: relative; cursor: pointer; }
        .badge-item.earned { border-color: var(--accent-glow); }
        .badge-item.locked { opacity: 0.4; }
        .badge-item:hover { opacity: 1; transform: translateY(-2px); }
        .badge-emoji { font-size: 1.5rem; margin-bottom: 4px; }
        .badge-name { font-size: 0.65rem; color: var(--text-dim); font-weight: 600; }
        .badge-tooltip { display: none; position: absolute; bottom: calc(100% + 8px); left: 50%; transform: translateX(-50%); background: var(--bg-side); border: 1px solid var(--border); color: var(--text); padding: 8px 12px; border-radius: 8px; font-size: 0.75rem; white-space: nowrap; z-index: 160; box-shadow: 0 4px 15px rgba(0,0,0,0.3); pointer-events: none; }
        .badge-tooltip::after { content: ''; position: absolute; top: 100%; left: 50%; transform: translateX(-50%); border: 6px solid transparent; border-top-color: var(--border); }
        .badge-item:hover .badge-tooltip { display: block; }
        @keyframes badgeBounce { 0% { transform: scale(0); } 50% { transform: scale(1.3); } 70% { transform: scale(0.9); } 100% { transform: scale(1); } }

        /* Quest Modal */
        #questModal { display: none; position: fixed; inset: 0; background: var(--overlay); z-index: 260; justify-content: center; align-items: center; overflow-y: auto; padding: 20px; }
        #questModal.open { display: flex; }
        #questInner { background: var(--bg-side); border: 1px solid var(--border); border-radius: 20px; padding: 40px; max-width: 550px; width: 100%; max-height: 90vh; overflow-y: auto; }
        .quest-header { text-align: center; margin-bottom: 30px; }
        .quest-badge { display: inline-block; background: var(--accent); color: #fff; padding: 6px 16px; border-radius: 20px; font-size: 0.8rem; font-weight: 800; letter-spacing: 1px; margin-bottom: 12px; }
        .quest-header h2 { color: var(--heading); font-size: 1.5rem; margin-bottom: 8px; }
        .quest-header p { color: var(--text-muted); font-size: 0.9rem; }
        .quest-q { margin-bottom: 24px; }
        .quest-q-num { color: var(--accent); font-weight: 800; font-size: 0.75rem; margin-bottom: 6px; }
        .quest-q-text { color: var(--heading); font-size: 1.05rem; font-weight: 600; margin-bottom: 12px; line-height: 1.4; }
        .quest-options { display: flex; flex-direction: column; gap: 8px; }
        .quest-opt { background: var(--card-bg); border: 1px solid var(--border); border-radius: 10px; padding: 12px 16px; color: var(--text); font-size: 0.95rem; cursor: pointer; text-align: left; font-family: inherit; transition: 0.15s; }
        .quest-opt:hover { border-color: var(--accent); }
        .quest-opt.selected { background: var(--accent-bg); border-color: var(--accent); color: var(--accent); font-weight: 700; }
        .quest-opt.correct { background: rgba(34,197,94,0.15); border-color: #22c55e; color: #22c55e; }
        .quest-opt.wrong { background: rgba(239,68,68,0.15); border-color: #ef4444; color: #ef4444; }
        .quest-opt:disabled { cursor: default; opacity: 0.8; }
        .quest-submit { width: 100%; padding: 16px; background: var(--accent); color: #fff; border: none; border-radius: 12px; font-size: 1.05rem; font-weight: 700; cursor: pointer; font-family: inherit; margin-top: 20px; transition: 0.2s; }
        .quest-submit:disabled { opacity: 0.4; cursor: not-allowed; }
        .quest-submit:not(:disabled):hover { filter: brightness(1.1); }
        .quest-skip { width: 100%; padding: 12px; background: none; border: none; color: var(--text-faint); font-size: 0.9rem; cursor: pointer; font-family: inherit; margin-top: 8px; }
        .quest-skip:hover { color: var(--text-dim); }
        .quest-result { text-align: center; margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--border); }
        .quest-result-msg { font-size: 1.3rem; font-weight: 800; color: var(--heading); margin-bottom: 20px; }
        .quest-retry { width: 100%; padding: 14px; background: var(--accent-bg); border: 1px solid var(--accent); border-radius: 12px; color: var(--accent); font-size: 1rem; font-weight: 700; cursor: pointer; font-family: inherit; margin-bottom: 10px; }
        .quest-done { width: 100%; padding: 14px; background: var(--accent); border: none; border-radius: 12px; color: #fff; font-size: 1rem; font-weight: 700; cursor: pointer; font-family: inherit; }

        /* Home Page */
        .home-page { display: flex; animation: fadeSlideIn 0.4s ease-out; align-items: center; justify-content: center; min-height: 100vh; text-align: center; padding: 60px 30px; background: radial-gradient(ellipse at 30% 20%, rgba(249,115,22,0.08) 0%, transparent 60%), radial-gradient(ellipse at 70% 80%, rgba(121,45,228,0.06) 0%, transparent 60%); }
        .home-page.hidden { display: none; }
        .home-inner { max-width: 650px; }
        .home-logos { display: flex; align-items: center; justify-content: center; gap: 20px; margin-bottom: 40px; }
        .channel-logos { display: flex; align-items: center; justify-content: center; gap: 14px; margin-bottom: 16px; }
        .channel-logos .channel-logo-img { width: 80px; height: 80px; border-radius: 50%; object-fit: cover; box-shadow: 0 0 24px rgba(247,147,26,0.35); }
        .channel-logos svg { width: 50px; height: 50px; }
        .home-btc { filter: drop-shadow(0 0 30px rgba(247,147,26,0.4)); }
        .home-ln { filter: drop-shadow(0 0 30px rgba(247,147,26,0.4)); }
        .home-title { font-size: 3.5rem; font-weight: 900; color: var(--heading); letter-spacing: -1px; line-height: 1.15; margin-bottom: 20px; }
        .home-subtitle { font-size: 1.2rem; color: #64748b; margin-bottom: 40px; line-height: 1.6; }
        .home-credits { background: rgba(255,255,255,0.03); border: 1px solid var(--border); border-radius: 16px; padding: 24px 30px; margin-bottom: 40px; text-align: left; }
        .home-credits p { color: var(--text-dim); font-size: 1rem; margin-bottom: 8px; line-height: 1.6; }
        .home-credits p:last-child { margin-bottom: 0; }
        .home-credits strong { color: var(--accent); }
        .home-stats { display: flex; justify-content: center; gap: 40px; margin-bottom: 40px; }
        .home-stat { display: flex; flex-direction: column; align-items: center; }
        .home-stat-num { font-size: 2rem; font-weight: 900; color: var(--accent); }
        .home-stat-label { font-size: 0.8rem; color: #475569; text-transform: uppercase; letter-spacing: 1px; margin-top: 4px; }
        .daily-channel { background: var(--card-bg); border: 1px solid var(--border); border-radius: 16px; padding: 20px 24px; margin-bottom: 30px; cursor: pointer; transition: 0.2s; text-align: left; }
        .daily-channel:hover { border-color: var(--accent); box-shadow: 0 4px 20px var(--accent-glow); }
        .daily-label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1.5px; color: var(--accent); font-weight: 800; margin-bottom: 8px; }
        .daily-title { color: var(--heading); font-size: 1.15rem; font-weight: 700; margin-bottom: 4px; }
        .daily-desc { color: var(--text-muted); font-size: 0.85rem; line-height: 1.4; }

        .home-cta { background: var(--accent); color: #fff; border: none; padding: 22px 60px; border-radius: 16px; font-size: 1.4rem; font-weight: 800; cursor: pointer; font-family: inherit; transition: 0.3s; letter-spacing: 0.5px; box-shadow: 0 4px 20px var(--accent-glow); margin-bottom: 30px; }
        .home-cta:hover { background: #ea580c; transform: translateY(-3px) scale(1.02); box-shadow: 0 12px 40px rgba(249,115,22,0.4); }
        .home-cta:active { transform: translateY(0) scale(0.98); }
        .suggest-box { background: var(--card-bg); border: 1px solid var(--border); border-radius: 16px; padding: 24px; margin-bottom: 30px; text-align: left; }
        .suggest-input { width: 100%; padding: 10px 14px; background: var(--input-bg); border: 1px solid var(--border); border-radius: 8px; color: var(--text); font-size: 0.9rem; font-family: inherit; outline: none; margin-bottom: 10px; resize: vertical; }
        .suggest-input:focus { border-color: var(--accent); }
        .suggest-input::placeholder { color: var(--text-faint); }
        .suggest-submit { width: 100%; padding: 12px; background: var(--accent); color: #fff; border: none; border-radius: 10px; font-size: 0.95rem; font-weight: 700; cursor: pointer; font-family: inherit; transition: 0.2s; }
        .suggest-submit:hover { filter: brightness(1.1); }
        .suggest-submit:disabled { opacity: 0.5; cursor: not-allowed; }
        #suggestStatus { text-align: center; margin-top: 10px; font-size: 0.85rem; }

        .home-footer { margin-top: 30px; color: #334155; font-size: 0.85rem; }

        @media (max-width: 900px) {
            .home-title { font-size: 2.4rem; }
            .home-stats { gap: 24px; }
            .home-stat-num { font-size: 1.5rem; }
        }

        /* Lightbox */
        .lightbox { display: none; position: fixed; inset: 0; background: var(--overlay); z-index: 200; justify-content: center; align-items: center; cursor: zoom-out; }
        .lightbox.open { display: flex; }
        .lightbox img { max-width: 90vw; max-height: 90vh; border-radius: 8px; }
        
        /* Mobile nav bar */
        .mobile-bar { display: none; }

        /* Mobile */
        /* Tablet breakpoint */
        @media (max-width: 1100px) and (min-width: 901px) {
            aside { width: 280px; }
            .hero { padding: 60px 40px 30px; }
            .messages { padding: 0 40px 80px; }
            .ch-btn { font-size: 0.85rem; padding: 9px 12px; }
        }

        /* Mobile breakpoint */
        @media (max-width: 900px) {
            aside { display: none; position: fixed; inset: 0; z-index: 100; width: 100%; max-width: 100%; }
            aside.open { display: flex; }
            body { flex-direction: column; }
            main { flex: 1; overflow-y: auto; -webkit-overflow-scrolling: touch; }
            .mobile-bar { display: flex; align-items: center; justify-content: space-between; padding: 12px 16px; background: var(--bg-side); border-bottom: 1px solid var(--border); flex-shrink: 0; position: sticky; top: 0; z-index: 50; }
            .mobile-bar h2 { color: var(--accent); font-size: 0.85rem; font-weight: 900; text-transform: uppercase; letter-spacing: 1px; }
            .mobile-bar button { background: none; border: 1px solid var(--border); color: var(--text-dim); padding: 8px 14px; border-radius: 8px; font-size: 0.85rem; cursor: pointer; font-family: inherit; -webkit-tap-highlight-color: transparent; }
            .mobile-bar button:active { background: rgba(249,115,22,0.15); color: var(--accent); border-color: var(--accent); }
            .mobile-close { display: flex !important; }
            .theme-toggle { position: absolute; top: 16px; right: 64px; z-index: 101; }
            #audioBtn { position: absolute; top: 16px; right: 108px; z-index: 101; }
            #volumeSlider { position: absolute; top: 24px; right: 152px; z-index: 101; width: 40px !important; }
            .hero { padding: 20px 16px 14px; }
            .hero h1 { font-size: 1.4rem; line-height: 1.3; }
            .hero .desc { font-size: 0.9rem; }
            .messages { padding: 0 16px 120px; }
            .msg { padding: 16px 0; }
            .msg-text { font-size: 0.95rem; line-height: 1.7; }
            .msg-img { max-width: 100%; height: auto; border-radius: 8px; }
            .msg-link { font-size: 0.85rem; }
            .share-bar { gap: 6px; }
            .share-btn { padding: 6px 10px; font-size: 0.75rem; }
            .back-to-top { bottom: 118px; left: 16px; right: auto; width: 40px; height: 40px; font-size: 1.1rem; }
            .scroll-to-bottom { bottom: 70px; left: 16px; right: auto; }
            .home-page { padding: 30px 16px; min-height: auto; }
            .home-title { font-size: 2rem; letter-spacing: -1px; }
            .home-subtitle { font-size: 1rem; margin-bottom: 24px; }
            .home-stats { gap: 12px; flex-wrap: wrap; }
            .home-stat-num { font-size: 1.3rem; }
            .home-stat-label { font-size: 0.7rem; }
            .home-credits { padding: 14px; }
            .home-credits p { font-size: 0.85rem; }
            .home-logos svg { width: 56px; height: 56px; }
            .channel-logos .channel-logo-img { width: 64px; height: 64px; }
            .channel-logos svg { width: 40px; height: 40px; }
            .daily-channel { padding: 14px; }
            .home-cta { padding: 16px 30px; font-size: 1.05rem; width: 100%; }
            .quest-start-btn { margin: 6px 10px; }
            .ch-btn { padding: 12px 14px; font-size: 0.9rem; -webkit-tap-highlight-color: transparent; }
            .cat-label { margin: 16px 0 6px 10px; }
            /* Quest modal mobile */
            #questInner { padding: 24px 18px; border-radius: 16px; }
            .quest-header h2 { font-size: 1.2rem; }
            .quest-q-text { font-size: 0.95rem; }
            .quest-opt { padding: 14px 16px; font-size: 0.9rem; }
            /* Badge toast mobile */
            .badge-toast { bottom: 70px; left: 10px; right: 10px; }
            /* Lightbox mobile */
            .lightbox img { max-width: 95vw; max-height: 85vh; }
            /* YouTube embeds mobile */
            .yt-embed { max-width: 100%; }
            /* Twitter previews mobile */
            .tw-preview { padding: 12px 14px; }
        }

        /* Small phones */
        @media (max-width: 380px) {
            .home-title { font-size: 1.6rem; }
            .home-stats { gap: 8px; }
            .home-stat-num { font-size: 1.1rem; }
            .mobile-bar h2 { font-size: 0.75rem; }
            .hero h1 { font-size: 1.2rem; }
            .msg-text { font-size: 0.9rem; }
            .home-cta { padding: 14px 20px; font-size: 0.95rem; }
        }
        /* Hide Google Translate bar */
        .goog-te-banner-frame { display: none !important; }
        body { top: 0 !important; }
        .skiptranslate { display: none !important; }
        #goog-gt-tt { display: none !important; }
    </style>
</head>
<body>
    <!-- Mobile top bar -->
    <div class="mobile-bar">
        <div onclick="goHome()" style="cursor:pointer;display:flex;align-items:center;gap:10px;">
            <svg viewBox="0 0 64 64" width="28" height="28" style="flex-shrink:0;"><circle cx="32" cy="32" r="30" fill="#f7931a"/><g transform="rotate(14,32,32)"><text x="32" y="44" text-anchor="middle" font-size="36" font-weight="bold" fill="#fff" font-family="Arial,sans-serif">B</text><line x1="28" y1="12" x2="28" y2="52" stroke="#fff" stroke-width="3"/><line x1="36" y1="12" x2="36" y2="52" stroke="#fff" stroke-width="3"/></g></svg>
            <h2 style="margin:0;line-height:1.2;">BITCOIN<br>EDUCATION ARCHIVE</h2>
        </div>
        <div style="display:flex;align-items:center;gap:8px;">
            <span id="mobileUserInfo" onclick="if(auth&&auth.currentUser&&!auth.currentUser.isAnonymous){showUsernamePrompt()}else{toggleMenu()}" style="font-size:0.75rem;color:var(--text-muted);cursor:pointer;display:none;"></span>
            <button onclick="toggleMenu()">‚ò∞ Menu</button>
        </div>
    </div>

    <aside id="sidebar">
        <button class="mobile-close" onclick="toggleMenu()">‚úï</button>
        <div class="sidebar-header">
            <div onclick="goHome()" style="cursor:pointer;display:flex;align-items:center;gap:10px;">
                <svg viewBox="0 0 64 64" width="28" height="28" style="flex-shrink:0;"><circle cx="32" cy="32" r="30" fill="#f7931a"/><g transform="rotate(14,32,32)"><text x="32" y="44" text-anchor="middle" font-size="36" font-weight="bold" fill="#fff" font-family="Arial,sans-serif">B</text><line x1="28" y1="12" x2="28" y2="52" stroke="#fff" stroke-width="3"/><line x1="36" y1="12" x2="36" y2="52" stroke="#fff" stroke-width="3"/></g></svg>
                <h2 style="margin:0;line-height:1.2;">BITCOIN<br>EDUCATION ARCHIVE</h2>
            </div>
            <div style="display:flex;align-items:center;gap:6px;">
                <button class="theme-toggle" onclick="toggleAudio()" title="Toggle sound" id="audioBtn" style="font-size:1rem;background:none;border:1px solid var(--border);color:var(--text-dim);width:32px;height:32px;border-radius:8px;cursor:pointer;">üîä</button>
                <input type="range" id="volumeSlider" min="0" max="1" step="0.05" value="0.5" oninput="setVolume(this.value)" style="width:50px;height:4px;accent-color:#f7931a;cursor:pointer;" title="Volume">
                <button class="theme-toggle" onclick="toggleTheme()" title="Toggle light/dark mode" id="themeBtn">üåô</button>
            </div>
        </div>
        <div class="search-box">
            <input type="text" class="search-input" id="searchInput" placeholder="üîç Search all channels..." oninput="doSearch(this.value)">
            <div style="display:flex;gap:8px;margin-top:8px;justify-content:center;">
                <button class="random-btn" onclick="goRandom()" title="Random Channel">üé≤</button>
                <button class="random-btn" onclick="goRandomArt()" title="Random Art">üé®</button>
                <button class="random-btn" onclick="goRandomMeme()" title="Random Meme">üòÇ</button>
            </div>
        </div>
        <div class="search-results" id="searchResults"></div>
        <div class="channels" id="channelList">
            <div id="favsSection" style="display:none;">
                <div class="cat-label">‚≠ê Your Saved Channels</div>
                <div id="favsList"></div>
            </div>
            <div class="cat-label cat-toggle" onclick="toggleCat(this)" data-expanded="true">Properties Layer 1 <span class="cat-arrow">‚ñº</span></div>
            <div class="cat-group">
            <button class="ch-btn active" onclick="go('whitepaper',this)">üìÑ whitepaper</button>
            <button class="ch-btn" onclick="go('decentralized',this)">üë™ decentralized-censorship-resistant</button>
            <button class="ch-btn" onclick="go('scarce',this)">üçÄ scarce-unforgeable</button>
            <button class="ch-btn" onclick="go('secure',this)">‚Ñ¢ secure-fungible</button>
            <button class="ch-btn" onclick="go('money',this)">üí∞ money-deflationary</button>
            <button class="ch-btn" onclick="go('peaceful',this)">‚òÆ peaceful-neutral</button>
            <button class="ch-btn" onclick="go('dominant',this)">üèÜ dominant-recognizable</button>
            <button class="ch-btn" onclick="go('organic',this)">üå≥ organic-empowering</button>
            <button class="ch-btn" onclick="go('supranational',this)">üïä supranational-lindy</button>
            <button class="ch-btn" onclick="go('programmable',this)">ü§ñ programable-interoperable</button>
            <button class="ch-btn" onclick="go('use-cases',this)">‚úî use-cases</button>

            </div>
            <div class="cat-label cat-toggle" onclick="toggleCat(this)" data-expanded="false">Experienced Topics <span class="cat-arrow">‚ñ∂</span></div>
            <div class="cat-group" style="display:none;">
            <button class="ch-btn" onclick="go('maximalism',this)">üíØ maximalism</button>
            <button class="ch-btn" onclick="go('problems-of-money',this)">üìâ problems-of-money</button>
            <button class="ch-btn" onclick="go('self-custody',this)">üîë self-custody-security</button>
            <button class="ch-btn" onclick="go('privacy-nonkyc',this)">ü§´ privacy-nonkyc</button>
            <button class="ch-btn" onclick="go('nodes',this)">üíª nodes</button>
            <button class="ch-btn" onclick="go('mining',this)">üåã mining</button>
            <button class="ch-btn" onclick="go('pow-vs-pos',this)">üí™ pow-vs-pos</button>
            <button class="ch-btn" onclick="go('energy',this)">üí° energy</button>
            <button class="ch-btn" onclick="go('difficulty-adjustment',this)">üò§ difficulty-adjustment</button>
            <button class="ch-btn" onclick="go('layer-2-lightning',this)">‚ö° layer-2-lightning</button>
            <button class="ch-btn" onclick="go('fedi-ark',this)">üõ° fedi-ark</button>
            <button class="ch-btn" onclick="go('chaumian-mints',this)">üí∏ chaumian-mints-ecash</button>
            <button class="ch-btn" onclick="go('ctv-covenants',this)">üìú ctv-bip119-covenants</button>
            <button class="ch-btn" onclick="go('extension-blocks',this)">üöß extension-blocks</button>
            <button class="ch-btn" onclick="go('op-codes',this)">üë®‚Äçüíª op-codes-simplicity</button>
            <button class="ch-btn" onclick="go('bitvm',this)">üñ• bitvm</button>
            <button class="ch-btn" onclick="go('layer-3-sidechains',this)">üì± layer-3-sidechains</button>
            <button class="ch-btn" onclick="go('stablecoins',this)">ü™ô stablecoins</button>
            <button class="ch-btn" onclick="go('smart-contracts',this)">üì± smart-contracts</button>
            <button class="ch-btn" onclick="go('blockchain-timechain',this)">‚õì blockchain-timechain</button>
            <button class="ch-btn" onclick="go('regulation',this)">üèõ regulation-policy</button>
            <button class="ch-btn" onclick="go('cryptography',this)">üîí cryptography-cypherpunks</button>
            <button class="ch-btn" onclick="go('core-source-code',this)">üíæ core-source-code</button>
            <button class="ch-btn" onclick="go('developers',this)">üñ• developers</button>
            <button class="ch-btn" onclick="go('investment-strategy',this)">ü§ë investment-strategy</button>
            <button class="ch-btn" onclick="go('evidence-against-alts',this)">‚ö† evidence-against-alts</button>
            <button class="ch-btn" onclick="go('consensus',this)">üåê consensus</button>

            </div>
            <div class="cat-label cat-toggle" onclick="toggleCat(this)" data-expanded="false">Resources <span class="cat-arrow">‚ñ∂</span></div>
            <div class="cat-group" style="display:none;">
            <button class="ch-btn" onclick="go('one-stop-shop',this)">üõë one-stop-shop</button>
            <button class="ch-btn" onclick="go('faq-glossary',this)">‚ùì faq-glossary</button>
            <button class="ch-btn" onclick="go('nostr',this)">üíú nostr</button>
            <button class="ch-btn" onclick="go('misconceptions-fud',this)">ü§° misconceptions-fud</button>
            <button class="ch-btn" onclick="go('books',this)">üìö books</button>
            <button class="ch-btn" onclick="go('videos',this)">üì∫ videos</button>
            <button class="ch-btn" onclick="go('podcasts',this)">üîä podcasts</button>
            <button class="ch-btn" onclick="go('articles-threads',this)">üìÉ articles-threads</button>
            <button class="ch-btn" onclick="go('informational-sites',this)">üìÉ informational-sites</button>
            <button class="ch-btn" onclick="go('curriculum',this)">üéì curriculum</button>
            <button class="ch-btn" onclick="go('research-theses',this)">‚úç research-theses</button>
            <button class="ch-btn" onclick="go('games',this)">üéÆ games</button>
            <button class="ch-btn" onclick="go('music',this)">üéµ music</button>
            <button class="ch-btn" onclick="go('movies-tv',this)">üé¨ movies-tv</button>
            <button class="ch-btn" onclick="go('hardware',this)">üíª hardware</button>
            <button class="ch-btn" onclick="go('poems-stories',this)">üìí poems-stories</button>
            <button class="ch-btn" onclick="go('apps-tools',this)">üçé apps-tools</button>
            <button class="ch-btn" onclick="go('projects-diy',this)">üîß projects-diy</button>
            <button class="ch-btn" onclick="go('art-inspiration',this)">ü§© art-inspiration</button>
            <button class="ch-btn" onclick="go('graphics',this)">üé® graphics</button>
            <button class="ch-btn" onclick="go('charts',this)">üìä charts</button>
            <button class="ch-btn" onclick="go('swag-merch',this)">üëï swag-merch</button>
            <button class="ch-btn" onclick="go('jobs-earn',this)">üë∑ jobs-earn</button>
            <button class="ch-btn" onclick="go('social-media',this)">üëç social-media</button>
            <button class="ch-btn" onclick="go('fun-facts',this)">üéâ fun-facts</button>
            <button class="ch-btn" onclick="go('news-adoption',this)">üì∞ news-adoption</button>
            <button class="ch-btn" onclick="go('history',this)">üìÜ history</button>
            <button class="ch-btn" onclick="go('international',this)">üåç international</button>
            <button class="ch-btn" onclick="go('satoshi-nakamoto',this)">ü¶∏ satoshi-nakamoto</button>
            <button class="ch-btn" onclick="go('giga-chad',this)">üëë giga-chad</button>
            <button class="ch-btn" onclick="go('health',this)">ü•© health</button>
            <button class="ch-btn" onclick="go('web5',this)">5‚É£ web5</button>
            <button class="ch-btn" onclick="go('memes-funny',this)">üòÇ memes-funny</button>

            </div>
            <div class="cat-label cat-toggle" onclick="toggleCat(this)" data-expanded="false">Additional Info <span class="cat-arrow">‚ñ∂</span></div>
            <div class="cat-group" style="display:none;">
            <button class="ch-btn" onclick="go('100_sats',this)">üíØ 100 Sats</button>
            <button class="ch-btn" onclick="go('analogies',this)">üîã Analogies</button>
            <button class="ch-btn" onclick="go('austrian_school_of_economics',this)">üá¶üáπ Austrian School</button>
            <button class="ch-btn" onclick="go('bip119',this)">üöß BIP119</button>
            <button class="ch-btn" onclick="go('bitcoin_exam',this)">üéì Bitcoin Exam</button>
            <button class="ch-btn" onclick="go('bitcoin_vs_real_estate',this)">üè† Bitcoin vs Real Estate</button>
            <button class="ch-btn" onclick="go('block_time-block-size',this)">‚è∞ Block Time-Block-Size</button>
            <button class="ch-btn" onclick="go('burn_bitcoin',this)">üî• Burn Bitcoin</button>
            <button class="ch-btn" onclick="go('byzantine_generals__problem',this)">‚öî Byzantine Generals</button>
            <button class="ch-btn" onclick="go('chaumian_e-cash_and_blind_signatures',this)">üí≤ Chaumian E-cash</button>
            <button class="ch-btn" onclick="go('coin_mixing_coinjoin_coin_control_utxo',this)">üåÄ Coin Mixing/Coinjoin</button>
            <button class="ch-btn" onclick="go('consensus',this)">ü§ù Consensus</button>
            <button class="ch-btn" onclick="go('cyles',this)">üö≤ Cycles</button>
            <button class="ch-btn" onclick="go('derivation_path',this)">‚Üï Derivation Path</button>
            <button class="ch-btn" onclick="go('discrete_log_contracts__dlcs',this)">üìù DLCs</button>
            <button class="ch-btn" onclick="go('dollar-bitcoin_milkshake_theory',this)">ü•§ Dollar-Bitcoin Milkshake Theory</button>
            <button class="ch-btn" onclick="go('dust',this)">‚è≥ Dust</button>
            <button class="ch-btn" onclick="go('elevator_pitches',this)">‚Üï Elevator Pitches</button>
            <button class="ch-btn" onclick="go('environment___energy',this)">üå≥ Environment & Energy</button>
            <button class="ch-btn" onclick="go('faith___religion',this)">üôè Faith & Religion</button>
            <button class="ch-btn" onclick="go('fedimints',this)">üíö Fedimints</button>
            <button class="ch-btn" onclick="go('feedback_loops',this)">‚û∞ Feedback Loops</button>
            <button class="ch-btn" onclick="go('1_first_principles',this)">1‚É£ First Principles</button>
            <button class="ch-btn" onclick="go('free_and_open_source_software__foss',this)">üíø FOSS</button>
            <button class="ch-btn" onclick="go('game_theory',this)">üèà Game Theory</button>
            <button class="ch-btn" onclick="go('geopolitics___macroeconomics',this)">üí∞ Geopolitics</button>
            <button class="ch-btn" onclick="go('governance',this)">üèõ Governance</button>
            <button class="ch-btn" onclick="go('ham_radio',this)">üìª Ham Radio</button>
            <button class="ch-btn" onclick="go('human_rights__social_justice_and_freedo',this)">üóΩ Human Rights</button>
            <button class="ch-btn" onclick="go('improved_incentive_structure',this)">‚úÖ Incentive Structure</button>
            <button class="ch-btn" onclick="go('laws_of_thermodynamics',this)">üî• Laws of Thermodynamics</button>
            <button class="ch-btn" onclick="go('lightning_node',this)">‚ö° Lightning Node</button>
            <button class="ch-btn" onclick="go('lindy_effect',this)">üë¥ Lindy Effect</button>
            <button class="ch-btn" onclick="go('market_cap',this)">üß¢ Market Cap</button>
            <button class="ch-btn" onclick="go('math',this)">‚ûï Math</button>
            <button class="ch-btn" onclick="go('mathematics',this)">‚ûï Mathematics</button>
            <button class="ch-btn" onclick="go('mev',this)">‚õè MEV</button>
            <button class="ch-btn" onclick="go('0_mining__hashing',this)">0‚É£ Mining (Hashing)</button>
            <button class="ch-btn" onclick="go('network_effects',this)">üåê Network Effects</button>
            <button class="ch-btn" onclick="go('open_source',this)">‚≠ï Open Source</button>
            <button class="ch-btn" onclick="go('oracle',this)">üîÆ Oracle</button>
            <button class="ch-btn" onclick="go('orange-pilling',this)">üü† Orange-Pilling</button>
            <button class="ch-btn" onclick="go('ordinals',this)">üî¢ Ordinals</button>
            <button class="ch-btn" onclick="go('ordinals__nfts_on_bitcoin__and_block_spa',this)">üî¢ Ordinals & Block Space</button>
            <button class="ch-btn" onclick="go('peace_and_anti-war',this)">‚òÆ Peace and Anti-War</button>
            <button class="ch-btn" onclick="go('philosophy',this)">üçé Philosophy</button>
            <button class="ch-btn" onclick="go('politics',this)">üèõ Politics</button>
            <button class="ch-btn" onclick="go('predictions',this)">üîÆ Predictions</button>
            <button class="ch-btn" onclick="go('public_key_vs_private_key',this)">üóù Public vs Private Key</button>
            <button class="ch-btn" onclick="go('rbf',this)">‚Üî RBF</button>
            <button class="ch-btn" onclick="go('risks__threats__attack_vectors__weaknes',this)">‚öî Risks & Threats</button>
            <button class="ch-btn" onclick="go('rollups',this)">ü•ê Rollups</button>
            <button class="ch-btn" onclick="go('sats__or__bits',this)">üí¨ Sats or Bits?</button>
            <button class="ch-btn" onclick="go('scalability',this)">üåê Scalability</button>
            <button class="ch-btn" onclick="go('sidechains',this)">‚ôª Sidechains</button>
            <button class="ch-btn" onclick="go('soft_vs_hard_forks',this)">üç¥ Soft vs Hard Forks</button>
            <button class="ch-btn" onclick="go('softwar',this)">üìñ Softwar</button>
            <button class="ch-btn" onclick="go('2__solved_technical_problems',this)">2‚É£ Solved Problems</button>
            <button class="ch-btn" onclick="go('simplified_payment_verification__spv',this)">‚úî SPV</button>
            <button class="ch-btn" onclick="go('stablecoins',this)">ü™ô Stablecoins</button>
            <button class="ch-btn" onclick="go('stratum_v2',this)">üü© Stratum V2</button>
            <button class="ch-btn" onclick="go('submarine_swap',this)">‚õµ Submarine Swap</button>
            <button class="ch-btn" onclick="go('swaps',this)">‚Üî Swaps</button>
            <button class="ch-btn" onclick="go('ta_tips',this)">üìà TA Tips</button>
            <button class="ch-btn" onclick="go('tail_emission',this)">üêà Tail Emission</button>
            <button class="ch-btn" onclick="go('taproot',this)">üß∞ Taproot</button>
            <button class="ch-btn" onclick="go('taro',this)">ü•ï Taro</button>
            <button class="ch-btn" onclick="go('the_future',this)">üîÆ The Future</button>
            <button class="ch-btn" onclick="go('time',this)">‚è∞ Time</button>
            <button class="ch-btn" onclick="go('time_preference',this)">üïë Time Preference</button>
            <button class="ch-btn" onclick="go('toxicity',this)">‚ò£ Toxicity</button>
            <button class="ch-btn" onclick="go('transaction_fees',this)">üí≤ Transaction Fees</button>
            <button class="ch-btn" onclick="go('unpopular_opinions',this)">üíÄ Unpopular Opinions</button>
            <button class="ch-btn" onclick="go('utxos',this)">üï≥ UTXOs</button>
            <button class="ch-btn" onclick="go('vbyte',this)">üèã vByte</button>

            </div>
            <div class="cat-label cat-toggle" onclick="toggleCat(this)" data-expanded="true">Referral Links <span class="cat-arrow">‚ñº</span></div>
            <div class="cat-group">
            <button class="ch-btn" onclick="go('referral-links',this)">üîó free-btc-referral-links</button>
            </div>
        </div>
        <button class="quest-start-btn" onclick="startQuestManual()">‚ö° Start a Quest</button>
        <button class="quest-start-btn" onclick="startScholarQuest()" style="background:var(--card-bg);border:2px solid #f7931a;color:var(--text);margin-top:4px;transition:0.2s;" onmouseover="this.style.background='linear-gradient(135deg,#f7931a,#ea580c)';this.style.color='#fff';this.style.boxShadow='0 0 20px rgba(247,147,26,0.4)';" onmouseout="this.style.background='var(--card-bg)';this.style.color='var(--text)';this.style.boxShadow='none';">üéì Bitcoin Scholar Certification Quest</button>
        <button id="supportBtn" class="quest-start-btn" style="background:none;border:1px solid var(--border);color:var(--text-muted);margin-top:4px;position:relative;" onclick="handleSupportClick()">üìß Support</button>
        <a href="https://603btc.com" target="_blank" class="sidebar-promo">‚ö° Powered by 603btc.com</a>
        <div id="rankBar"></div>
    </aside>
    <div class="progress-bar" id="progressBar"></div>
    <button class="back-to-top" id="backToTop" onclick="document.getElementById('main').scrollTo({top:0,behavior:'smooth'})">‚Üë</button>
    <button class="back-to-top scroll-to-bottom" id="scrollToBottom" onclick="var m=document.getElementById('main');m.scrollTo({top:m.scrollHeight,behavior:'smooth'})">‚Üì</button>
    <main id="main">
        <!-- Home / Landing -->
        <div id="home" class="home-page">
            <div class="home-inner">
                <div class="home-logos">
                    <img src="images/btc-grad-logo.jpg" alt="Bitcoin Education Archive" style="width:130px;height:130px;border-radius:50%;object-fit:cover;box-shadow:0 0 40px rgba(247,147,26,0.4);">
                    <svg class="home-ln" viewBox="0 0 64 64" width="80" height="80"><circle cx="32" cy="32" r="30" fill="#f7931a"/><polygon points="36,10 22,38 30,38 28,54 42,26 34,26" fill="#fff"/></svg>
                </div>
                <h1 class="home-title">Bitcoin Education Archive</h1>
                <p class="home-subtitle">A curated library of Bitcoin education ‚Äî complete with Quests to test your knowledge. Start your Quest today!</p>
                <div class="home-stats">
                    <div class="home-stat"><span class="home-stat-num">146</span><span class="home-stat-label">Channels</span></div>
                    <div class="home-stat"><span class="home-stat-num">8,800+</span><span class="home-stat-label">Messages</span></div>
                    <div class="home-stat"><span class="home-stat-num">3,000+</span><span class="home-stat-label">Images</span></div>
                    <div class="home-stat"><span class="home-stat-num" id="visitCount">‚Äî</span><span class="home-stat-label">Total Visits</span></div>
                </div>
                <div style="margin-top:16px;margin-bottom:8px;">
                    <button onclick="var msg=document.getElementById('contentNote');if(msg.style.display==='none'){msg.style.display='block';this.textContent='üìå A note about the content in our channels ‚ñ≤'}else{msg.style.display='none';this.textContent='üìå A note about the content in our channels ‚ñº'}" style="padding:10px 20px;background:none;border:1px solid var(--border);color:var(--text-muted);border-radius:10px;font-size:0.9rem;cursor:pointer;font-family:inherit;transition:0.2s;">üìå A note about the content in our channels ‚ñº</button>
                    <div id="contentNote" style="display:none;margin-top:12px;padding:16px 20px;background:var(--card-bg);border:1px solid var(--border);border-radius:12px;color:var(--text);font-size:0.95rem;line-height:1.6;">
                        All YouTube links are embedded for you and contain videos that supplement the information in each channel. Additionally, channels are filled with tweets that were posted on Twitter over the last few years, and you can expand these tweets to view them in the channel.
                    </div>
                </div>
                <div id="giveawayBanner" style="margin-bottom:16px;padding:20px;background:linear-gradient(135deg,#f7931a 0%,#ea580c 100%);border-radius:16px;text-align:center;cursor:pointer;box-shadow:0 4px 20px rgba(247,147,26,0.3);position:relative;overflow:hidden;" onclick="showUsernamePrompt()">
                    <div style="position:absolute;top:-20px;right:-20px;font-size:5rem;opacity:0.15;pointer-events:none;">‚ö°</div>
                    <div style="font-size:1.8rem;margin-bottom:6px;">üéâ 25,000 SATS GIVEAWAY üéâ</div>
                    <div style="color:rgba(255,255,255,0.95);font-size:1rem;font-weight:600;">New users are entered for a chance to win!</div>
                    <div style="color:rgba(255,255,255,0.75);font-size:0.85rem;margin-top:6px;">Create an account & register below ‚¨áÔ∏è</div>
                    <div style="display:inline-block;margin-top:12px;padding:10px 24px;background:rgba(255,255,255,0.2);border:2px solid rgba(255,255,255,0.5);border-radius:10px;color:#fff;font-weight:700;font-size:0.95rem;letter-spacing:0.5px;">Sign Up Now ‚Üí</div>
                </div>
                <div id="continueReading" style="display:none;margin-bottom:16px;"></div>
                <div class="daily-channel" id="dailyChannel"></div>
                <div id="quoteOfDay" style="margin-top:16px;"></div>
                <div id="explorationMap" style="margin-top:16px;"></div>
                <div id="newbieBtnWrap" style="margin-top:20px;margin-bottom:20px;">
                    <button id="newbieBtn" onclick="document.getElementById('newbieMsg').style.display='block';this.style.display='none';" style="padding:14px 32px;background:none;border:2px solid #22c55e;color:#22c55e;border-radius:12px;font-size:1.05rem;font-weight:700;cursor:pointer;font-family:inherit;transition:0.2s;" onmouseover="this.style.background='#22c55e';this.style.color='#fff'" onmouseout="this.style.background='none';this.style.color='#22c55e'">üü¢ Brand new to Bitcoin?</button>
                    <div id="newbieMsg" style="display:none;margin-top:12px;padding:16px 20px;background:var(--card-bg);border:1px solid var(--border);border-radius:12px;color:var(--text);font-size:0.95rem;line-height:1.5;">
                        We built a channel just for you. Visit <a href="#one-stop-shop" onclick="go('one-stop-shop');return false;" style="color:var(--accent);font-weight:700;text-decoration:underline;cursor:pointer;">one-stop-shop</a> to hit the highlights of Bitcoin.
                    </div>
                </div>
                <div id="welcomeBanner" style="display:none;margin-bottom:16px;padding:12px 20px;background:var(--card-bg);border:1px solid var(--border);border-radius:12px;text-align:center;cursor:pointer;" onclick="showUsernamePrompt()"></div>
                <div style="display:flex;flex-direction:column;align-items:center;gap:12px;margin-bottom:10px;">
                    <button class="home-cta" onclick="go('whitepaper')" style="margin-bottom:0;">Start Exploring ‚Üí</button>
                    <button id="authBtn" onclick="showUsernamePrompt()" style="display:inline-block;padding:12px 30px;background:none;border:2px solid var(--accent);color:var(--accent);border-radius:12px;font-size:1rem;font-weight:700;cursor:pointer;font-family:inherit;transition:0.2s;" onmouseover="this.style.background='var(--accent)';this.style.color='#fff'" onmouseout="this.style.background='none';this.style.color='var(--accent)'">Create Free Account / Sign In</button>
<!-- random buttons moved to channel footer only -->
                </div>
                <div style="margin-top:20px;padding:16px 20px;background:var(--card-bg);border:1px solid var(--border);border-radius:12px;">
                    <div style="font-size:1.2rem;margin-bottom:6px;">üë©‚Äçüéì</div>
                    <div style="color:var(--heading);font-weight:700;font-size:1rem;margin-bottom:4px;">Study with Flashcards</div>
                    <p style="color:var(--text-muted);font-size:0.85rem;margin-bottom:12px;">Prepare for Quests! Pick a topic and study with interactive flashcards.</p>
                    <div style="display:flex;flex-wrap:wrap;gap:8px;justify-content:center;">
                        <button onclick="startFlashcards('Bitcoin Basics')" style="padding:8px 16px;background:var(--bg-side);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:0.85rem;cursor:pointer;font-family:inherit;transition:0.2s;" onmouseover="this.style.borderColor='var(--accent)'" onmouseout="this.style.borderColor='var(--border)'">‚Çø Bitcoin Basics</button>
                        <button onclick="startFlashcards('Security & Storage')" style="padding:8px 16px;background:var(--bg-side);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:0.85rem;cursor:pointer;font-family:inherit;transition:0.2s;" onmouseover="this.style.borderColor='var(--accent)'" onmouseout="this.style.borderColor='var(--border)'">üîë Security & Storage</button>
                        <button onclick="startFlashcards('Lightning Network')" style="padding:8px 16px;background:var(--bg-side);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:0.85rem;cursor:pointer;font-family:inherit;transition:0.2s;" onmouseover="this.style.borderColor='var(--accent)'" onmouseout="this.style.borderColor='var(--border)'">‚ö° Lightning Network</button>
                        <button onclick="startFlashcards('Mining & Energy')" style="padding:8px 16px;background:var(--bg-side);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:0.85rem;cursor:pointer;font-family:inherit;transition:0.2s;" onmouseover="this.style.borderColor='var(--accent)'" onmouseout="this.style.borderColor='var(--border)'">‚õèÔ∏è Mining & Energy</button>
                        <button onclick="startFlashcards('Economics & Money')" style="padding:8px 16px;background:var(--bg-side);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:0.85rem;cursor:pointer;font-family:inherit;transition:0.2s;" onmouseover="this.style.borderColor='var(--accent)'" onmouseout="this.style.borderColor='var(--border)'">üí∞ Economics & Money</button>
                    </div>
                    <div id="moreFlashcards" style="display:none;margin-top:10px;">
                        <div style="display:flex;flex-wrap:wrap;gap:8px;justify-content:center;">
                            <button onclick="startFlashcards('Privacy & Sovereignty')" style="padding:8px 16px;background:var(--bg-side);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:0.85rem;cursor:pointer;font-family:inherit;transition:0.2s;" onmouseover="this.style.borderColor='var(--accent)'" onmouseout="this.style.borderColor='var(--border)'">üïµÔ∏è Privacy & Sovereignty</button>
                            <button onclick="startFlashcards('History & Culture')" style="padding:8px 16px;background:var(--bg-side);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:0.85rem;cursor:pointer;font-family:inherit;transition:0.2s;" onmouseover="this.style.borderColor='var(--accent)'" onmouseout="this.style.borderColor='var(--border)'">üìú History & Culture</button>
                            <button onclick="startFlashcards('Wallets & Tools')" style="padding:8px 16px;background:var(--bg-side);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:0.85rem;cursor:pointer;font-family:inherit;transition:0.2s;" onmouseover="this.style.borderColor='var(--accent)'" onmouseout="this.style.borderColor='var(--border)'">üíº Wallets & Tools</button>
                            <button onclick="startFlashcards('Common Myths Debunked')" style="padding:8px 16px;background:var(--bg-side);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:0.85rem;cursor:pointer;font-family:inherit;transition:0.2s;" onmouseover="this.style.borderColor='var(--accent)'" onmouseout="this.style.borderColor='var(--border)'">üö´ Common Myths Debunked</button>
                            <button onclick="startFlashcards('Technical Deep Dives')" style="padding:8px 16px;background:var(--bg-side);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:0.85rem;cursor:pointer;font-family:inherit;transition:0.2s;" onmouseover="this.style.borderColor='var(--accent)'" onmouseout="this.style.borderColor='var(--border)'">üî¨ Technical Deep Dives</button>
                        </div>
                    </div>
                    <button id="expandFlashBtn" onclick="var m=document.getElementById('moreFlashcards');if(m.style.display==='none'){m.style.display='block';this.textContent='‚ñ≤ Show Less'}else{m.style.display='none';this.textContent='‚ñº Show More Topics'}" style="margin-top:10px;padding:6px 16px;background:none;border:1px solid var(--border);border-radius:8px;color:var(--text-muted);font-size:0.8rem;cursor:pointer;font-family:inherit;transition:0.2s;" onmouseover="this.style.borderColor='var(--accent)';this.style.color='var(--accent)'" onmouseout="this.style.borderColor='var(--border)';this.style.color='var(--text-muted)'">‚ñº Show More Topics</button>
                </div>
                <div class="suggest-box" onclick="expandSuggest()" id="suggestBox" style="cursor:pointer;">
                    <h3 style="color:var(--heading);font-size:1rem;margin-bottom:8px;">üí° Suggest a Topic or Leave Feedback</h3>
                    <p style="color:var(--text-muted);font-size:0.85rem;margin-bottom:0;">Want to see something added to the archive? Let us know!</p>
                    <div id="suggestFields" style="display:none;margin-top:12px;">
                        <input type="text" id="suggestName" placeholder="Your name (optional)" class="suggest-input" onclick="event.stopPropagation()">
                        <textarea id="suggestText" placeholder="What topic should we add? Or share your feedback!" class="suggest-input" rows="3" onclick="event.stopPropagation()"></textarea>
                        <button class="suggest-submit" onclick="event.stopPropagation();submitSuggestion()">Submit Suggestion</button>
                        <div id="suggestStatus"></div>
                    </div>
                </div>
                <div style="margin-top:20px;padding:20px;background:linear-gradient(135deg,rgba(247,147,26,0.05),rgba(247,147,26,0.02));border:2px dashed rgba(247,147,26,0.3);border-radius:12px;text-align:center;">
                    <div style="font-size:1.3rem;margin-bottom:6px;">üì£</div>
                    <div style="color:var(--heading);font-weight:700;font-size:1rem;margin-bottom:4px;">Sponsor This Space</div>
                    <p style="color:var(--text-muted);font-size:0.85rem;margin-bottom:12px;">Advertise your Bitcoin company here and reach thousands of Bitcoiners.</p>
                    <a href="mailto:info.603btc@gmail.com?subject=Sponsorship%20Inquiry%20-%20Bitcoin%20Education%20Archive" style="display:inline-block;padding:10px 24px;background:var(--accent);color:#fff;border-radius:10px;font-size:0.9rem;font-weight:700;text-decoration:none;font-family:inherit;">Inquire Now ‚Üí</a>
                    <div style="color:#fff;font-size:0.8rem;margin-top:8px;">info.603btc@gmail.com</div>
                </div>
                <div style="margin-top:20px;padding:16px 20px;background:var(--card-bg);border:1px solid var(--border);border-radius:12px;text-align:center;">
                    <div style="font-size:1.5rem;margin-bottom:6px;">‚ù§Ô∏è</div>
                    <div style="color:var(--heading);font-weight:700;font-size:1rem;margin-bottom:4px;">Support the Archive</div>
                    <p style="color:var(--text-muted);font-size:0.85rem;margin-bottom:16px;">Donations are greatly appreciated and go towards site upkeep. Thank you for your support!</p>
                    <img src="donation-qr.jpg" alt="Bitcoin Donation QR Code" style="width:200px;height:auto;margin-bottom:12px;border:2px solid var(--border);border-radius:8px;box-shadow:0 2px 12px rgba(0,0,0,0.1);">
                    <div style="color:var(--accent);font-weight:600;font-size:0.95rem;margin-bottom:8px;">spontaneousleopard54@zeuspay.com</div>
                    <p style="color:var(--text-faint);font-size:0.85rem;margin-bottom:0;">‚ö†Ô∏è Donations are non-refundable</p>
                </div>
                <div class="home-credits">
                    <p><strong>Lead Curator:</strong> Pleb "<a href="https://x.com/NEEDcreations" target="_blank" rel="noopener" style="color:var(--accent);text-decoration:none;">NEEDcreations</a>" Phil</p>
                    <p><strong>Other Contributors:</strong> Hundreds of Bitcoiners from Bitcoin Twitter, Bitcoin X, and the Bitcoin Education Discord community</p>
                </div>
                <p class="home-footer">Open source ¬∑ Free forever ¬∑ Built on GitHub Pages<br><a href="/privacy.html" style="color:var(--text-faint);font-size:0.75rem;">Privacy Policy</a> ¬∑ <a href="/terms.html" style="color:var(--text-faint);font-size:0.75rem;">Terms of Service</a></p>
            </div>
        </div>
        <div class="hero" id="hero"></div>
        <div class="messages" id="msgs"></div>
    </main>
    <div class="lightbox" id="lb" onclick="this.classList.remove('open')"><img id="lb-img"></div>
    <div id="questModal" onclick="if(event.target===this)closeQuest()"><div id="questInner"></div></div>
    <button id="lbFloatBtn" onclick="toggleLeaderboard()" style="position:fixed;bottom:20px;right:20px;z-index:140;background:var(--accent);color:#fff;border:none;border-radius:14px;padding:12px 18px;font-size:0.9rem;font-weight:700;cursor:pointer;font-family:inherit;box-shadow:0 4px 20px rgba(0,0,0,0.3);display:flex;align-items:center;gap:6px;transition:0.2s;">üèÜ Leaderboard</button>
    <div id="leaderboard"></div>
    <div id="usernameModal" onclick="if(event.target===this)hideUsernamePrompt()">
        <div class="username-box" style="position:relative;">
            <h2>‚ö° Join the Leaderboard</h2>
            <p>Pick a username to start earning points as you explore the archive!</p>
            <input type="text" id="usernameInput" placeholder="Enter a username..." maxlength="20" onkeydown="if(event.key==='Enter')submitUsername()">
            <input type="email" id="emailInput" placeholder="üìß Email (optional)" style="margin-top:0;">
            <p style="color:#475569;font-size:0.75rem;margin:-8px 0 16px;">We'll never spam you. Only used if we launch future Bitcoin education updates.</p>
            <div id="giveawaySection" style="background:linear-gradient(135deg,rgba(247,147,26,0.1),rgba(234,88,12,0.05));border:1px solid rgba(247,147,26,0.3);border-radius:12px;padding:14px;margin-bottom:16px;text-align:left;">
                <label style="display:flex;align-items:flex-start;gap:10px;cursor:pointer;margin-bottom:10px;">
                    <input type="checkbox" id="giveawayCheckbox" style="width:20px;height:20px;accent-color:#f7931a;margin-top:2px;flex-shrink:0;cursor:pointer;">
                    <span style="color:var(--text);font-size:0.9rem;font-weight:600;line-height:1.4;">üéâ Register for the <span style="color:#f7931a;">25,000 sats giveaway!</span></span>
                </label>
                <input type="text" id="giveawayLnAddress" placeholder="‚ö° Lightning address (e.g. you@walletofsatoshi.com)" style="width:100%;padding:12px 14px;background:var(--input-bg);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:0.85rem;font-family:inherit;outline:none;display:none;" oninput="this.style.borderColor='var(--border)'">
                <p id="giveawayNote" style="color:var(--text-faint);font-size:0.7rem;margin:6px 0 0;display:none;">Enter a Lightning address so we can send you the sats if you win! üèÜ</p>
            </div>
            <script>
                document.getElementById('giveawayCheckbox').addEventListener('change', function() {
                    document.getElementById('giveawayLnAddress').style.display = this.checked ? 'block' : 'none';
                    document.getElementById('giveawayNote').style.display = this.checked ? 'block' : 'none';
                });
            </script>
            <button onclick="submitUsername()">Start Learning ‚Üí</button>
            <div style="margin-top:12px;padding-top:12px;border-top:1px solid var(--border);">
                <p style="color:var(--text-faint);font-size:0.75rem;margin-bottom:8px;">Or sign in to sync across devices:</p>
                <button onclick="signInWithGoogle()" style="width:100%;padding:12px;background:var(--card-bg);border:1px solid var(--border);border-radius:10px;color:var(--text);font-size:0.9rem;cursor:pointer;font-family:inherit;display:flex;align-items:center;justify-content:center;gap:8px;transition:0.2s;margin-bottom:6px;">
                    <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="18" height="18"> Sign in with Google
                </button>
                <button onclick="signInWithTwitter()" style="width:100%;padding:12px;background:var(--card-bg);border:1px solid var(--border);border-radius:10px;color:var(--text);font-size:0.9rem;cursor:pointer;font-family:inherit;display:flex;align-items:center;justify-content:center;gap:8px;transition:0.2s;margin-bottom:6px;">
                    ùïè Sign in with Twitter/X
                </button>
                <button onclick="signInWithGithub()" style="width:100%;padding:12px;background:var(--card-bg);border:1px solid var(--border);border-radius:10px;color:var(--text);font-size:0.9rem;cursor:pointer;font-family:inherit;display:flex;align-items:center;justify-content:center;gap:8px;transition:0.2s;margin-bottom:6px;">
                    <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/github.svg" width="18" height="18"> Sign in with GitHub
                </button>
                <button onclick="signInWithFacebook()" style="width:100%;padding:12px;background:var(--card-bg);border:1px solid var(--border);border-radius:10px;color:var(--text);font-size:0.9rem;cursor:pointer;font-family:inherit;display:flex;align-items:center;justify-content:center;gap:8px;transition:0.2s;margin-bottom:6px;">
                    <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/facebook.svg" width="18" height="18"> Sign in with Facebook
                </button>
<!-- Apple sign-in removed -->
            </div>
            <span class="skip" onclick="hideUsernamePrompt()">Skip for now</span>
        </div>
    </div>

    <script src="channel_index.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js" defer></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js" defer></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js" defer></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-messaging-compat.js" defer></script>
    <script src="ranking.js" defer></script>
    <script src="quests.js" defer></script>
    <script src="scholar.js" defer></script>
    <script src="features.js" defer></script>
    <script src="badges.js" defer></script>
    <script src="tickets.js" defer></script>
    <script src="nacho.js" defer></script>
    <script src="nacho-live.js" defer></script>
    <script src="nacho-engage.js" defer></script>
    <script src="nacho-qa.js" defer></script>
    <script src="nacho-closet.js" defer></script>
    <script>
    function openImg(src) {
        document.getElementById('lb-img').src = src;
        document.getElementById('lb').classList.add('open');
    }

    function isMobile() { return window.innerWidth <= 900; }

    function toggleTheme() {
        const isDark = document.body.getAttribute('data-theme') !== 'light';
        document.body.setAttribute('data-theme', isDark ? 'light' : 'dark');
        document.getElementById('themeBtn').textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
        localStorage.setItem('btc_theme', isDark ? 'light' : 'dark');
    }
    // Restore saved theme
    (function() {
        const saved = localStorage.getItem('btc_theme');
        if (saved === 'light') {
            document.body.setAttribute('data-theme', 'light');
            setTimeout(() => { const b = document.getElementById('themeBtn'); if(b) b.textContent = '‚òÄÔ∏è'; }, 0);
        }
        // Set audio state
        setTimeout(() => { updateAudioUI(); }, 0);
    })();

    function toggleMenu() {
        document.getElementById('sidebar').classList.toggle('open');
    }

    function toggleCat(label) {
        var group = label.nextElementSibling;
        var arrow = label.querySelector('.cat-arrow');
        var expanded = label.getAttribute('data-expanded') === 'true';
        if (expanded) {
            group.style.display = 'none';
            label.setAttribute('data-expanded', 'false');
            if (arrow) arrow.textContent = '‚ñ∂';
        } else {
            group.style.display = '';
            label.setAttribute('data-expanded', 'true');
            if (arrow) arrow.textContent = '‚ñº';
        }
    }

    // Auto-expand the section when navigating to a channel
    function expandCatForChannel(btn) {
        if (!btn) return;
        var group = btn.closest('.cat-group');
        if (group && group.style.display === 'none') {
            var label = group.previousElementSibling;
            if (label && label.classList.contains('cat-toggle')) {
                group.style.display = '';
                label.setAttribute('data-expanded', 'true');
                var arrow = label.querySelector('.cat-arrow');
                if (arrow) arrow.textContent = '‚ñº';
            }
        }
    }

    function getFavs() { return JSON.parse(localStorage.getItem('btc_favs') || '[]'); }
    function setFavs(f) { localStorage.setItem('btc_favs', JSON.stringify(f)); renderFavs(); }

    function toggleFav(id, btn) {
        let favs = getFavs();
        if (favs.includes(id)) {
            favs = favs.filter(f => f !== id);
            if (btn) btn.innerHTML = '‚òÜ Save';
        } else {
            favs.push(id);
            if (btn) btn.innerHTML = '‚≠ê Saved';
        }
        setFavs(favs);
        // Sync to Firebase
        if (typeof syncFavsToFirebase === 'function') syncFavsToFirebase();
    }

    function renderFavs() {
        const favs = getFavs();
        const section = document.getElementById('favsSection');
        const list = document.getElementById('favsList');
        if (favs.length === 0) { section.style.display = 'none'; return; }
        section.style.display = 'block';
        list.innerHTML = favs.map(id => {
            const meta = CHANNELS[id];
            if (!meta) return '';
            const short = meta.title.length > 28 ? meta.title.substring(0, 28) + '...' : meta.title;
            return '<button class="ch-btn" onclick="go(\'' + id + '\',this)">‚≠ê ' + short + '</button>';
        }).join('');
    }

    let galleryMode = false;
    let currentChannelData = null;
    let currentChannelId = null;

    function toggleGallery(id) {
        galleryMode = !galleryMode;
        const btn = document.getElementById('galleryBtn');
        if (btn) {
            btn.classList.toggle('active', galleryMode);
            btn.textContent = galleryMode ? 'üìÑ List View' : 'üñºÔ∏è Gallery View';
        }
        renderContent(id);
    }

    function renderContent(id) {
        const d = currentChannelData;
        if (!d) return;
        const msgsEl = document.getElementById('msgs');

        if (galleryMode) {
            // Collect all images
            let allImgs = [];
            d.msgs.forEach(m => {
                if (m.imgs) m.imgs.forEach(img => allImgs.push(img));
            });

            let html = '<div class="gallery-grid">';
            const PAGE = 100;
            const showing = allImgs.slice(0, PAGE);
            showing.forEach(img => {
                html += '<img src="' + img + '" onclick="openImg(this.src)" loading="lazy">';
            });
            html += '</div>';
            if (allImgs.length > PAGE) {
                window._galleryImgs = allImgs;
                window._galleryOffset = PAGE;
                html += '<button class="load-more-btn" id="loadMoreGallery" onclick="loadMoreGallery()">Load more (' + (allImgs.length - PAGE) + ' remaining)</button>';
            }
            msgsEl.innerHTML = html;
        } else {
            // Normal list view - re-render
            const PAGE_SIZE = 50;
            // Skip the first message since it's already shown in the hero description
            const allMsgs = d.msgs.length > 1 ? d.msgs.slice(1) : d.msgs;

            function renderBatch(startIdx) {
                const batch = allMsgs.slice(startIdx, startIdx + PAGE_SIZE);
                let html = '';
                batch.forEach((m, bi) => {
                    html += '<div class="msg" id="msg-' + (startIdx + bi) + '">';
                    if (m.text) {
                        let t = m.text;
                        // Embed YouTube videos ‚Äî extract them first, replace with placeholders
                        let ytEmbeds = [];
                        t = t.replace(/(?:https?:\/\/)?(?:www\.)?youtube\.com\/watch\?v=([\w-]+)(?:[&?][^\s]*)?/g, function(match, id) {
                            ytEmbeds.push(id);
                            return '%%YT' + (ytEmbeds.length - 1) + '%%';
                        });
                        t = t.replace(/(?:https?:\/\/)?youtu\.be\/([\w-]+)(?:\?[^\s]*)?/g, function(match, id) {
                            ytEmbeds.push(id);
                            return '%%YT' + (ytEmbeds.length - 1) + '%%';
                        });
                        // Extract Twitter/X links for click-to-embed
                        let twEmbeds = [];
                        t = t.replace(/(?:https?:\/\/)?(?:twitter\.com|x\.com)\/([\w]+)\/status\/(\d+)(?:[^\s]*)?/g, function(match) {
                            const url = match.startsWith('http') ? match : 'https://' + match;
                            twEmbeds.push(url);
                            return '%%TW' + (twEmbeds.length - 1) + '%%';
                        });
                        // Now linkify remaining URLs
                        t = t.replace(/(https?:\/\/[^\s<>"]+)/g, '<a class="msg-link" href="$1" target="_blank">$1</a>');
                        // Restore YouTube embeds
                        t = t.replace(/%%YT(\d+)%%/g, function(match, idx) {
                            return '<div class="yt-embed"><iframe src="https://www.youtube-nocookie.com/embed/' + ytEmbeds[parseInt(idx)] + '" frameborder="0" allowfullscreen loading="lazy"></iframe></div>';
                        });
                        // Restore Twitter embeds as click-to-load cards
                        t = t.replace(/%%TW(\d+)%%/g, function(match, idx) {
                            const twUrl = twEmbeds[parseInt(idx)];
                            const twId = 'tw_' + Math.random().toString(36).substr(2, 8);
                            const isMob = typeof isMobile === 'function' && isMobile();
                            const handle = twUrl.match(/(?:twitter\.com|x\.com)\/([\w]+)\//);
                            const displayHandle = handle ? '@' + handle[1] : twUrl.replace(/https?:\/\/(www\.)?/, '');
                            return '<div class="tw-preview" id="' + twId + '" onclick="loadTweetEmbed(\'' + twId + '\',\'' + twUrl.replace(/'/g, "\\'") + '\')">' +
                                '<div class="tw-preview-icon">ùïè</div>' +
                                '<div class="tw-preview-content">' +
                                '<div class="tw-preview-url">' + displayHandle + '</div>' +
                                '<div class="tw-preview-hint">' + (isMob ? '‚ñ∂ Tap to display tweet' : '‚ñ∂ Click to display tweet') + '</div>' +
                                '</div>' +
                                '<div class="tw-preview-arrow">‚Üí</div>' +
                                '</div>';
                        });
                        t = t.replace(/üü† (.+)/g, '<span class="orange-glow">$1</span>');
                        html += '<div class="msg-text">' + t + '</div>';
                    }
                    if (m.imgs) m.imgs.forEach(img => {
                        if (m.link) {
                            html += '<a href="' + m.link + '" target="_blank" style="display:block;"><img class="msg-img" src="' + img + '" loading="lazy" title="Click to open source"></a>';
                        } else {
                            html += '<img class="msg-img" src="' + img + '" onclick="openImg(this.src)" loading="lazy">';
                        }
                    });
                    html += '</div>';
                });
                return html;
            }

            let msgsHtml = renderBatch(0);
            if (allMsgs.length > PAGE_SIZE) {
                msgsHtml += '<button class="load-more-btn" id="loadMoreBtn" onclick="loadMoreMsgs()">Load more (' + (allMsgs.length - PAGE_SIZE) + ' remaining)</button>';
            }
            msgsEl.innerHTML = msgsHtml;
            window._currentMsgs = allMsgs;
            window._currentOffset = PAGE_SIZE;
        }

        // Add Next + Random buttons at the bottom
        // Use sidebar order for navigation
        if (!window._sidebarOrder) {
            window._sidebarOrder = [...document.querySelectorAll('.ch-btn')].map(b => {
                const m = b.getAttribute('onclick').match(/go\('([^']+)'/);
                return m ? m[1] : null;
            }).filter(Boolean);
        }
        const channelKeys = window._sidebarOrder.length > 0 ? window._sidebarOrder : Object.keys(CHANNELS);
        const currentIdx = channelKeys.indexOf(id);
        const nextId = currentIdx < channelKeys.length - 1 ? channelKeys[currentIdx + 1] : channelKeys[0];
        const nextTitle = CHANNELS[nextId] ? CHANNELS[nextId].title : nextId;

        const prevId = currentIdx > 0 ? channelKeys[currentIdx - 1] : channelKeys[channelKeys.length - 1];
        const prevTitle = CHANNELS[prevId] ? CHANNELS[prevId].title : prevId;

        let navHtml = '<div style="display:flex;gap:12px;justify-content:center;align-items:center;padding:30px 0 40px;border-top:1px solid var(--border);margin-top:30px;flex-wrap:wrap;">';
        navHtml += '<button onclick="go(\'' + prevId + '\')" style="padding:12px 24px;background:var(--card-bg);border:1px solid var(--border);border-radius:10px;font-size:0.95rem;font-weight:700;cursor:pointer;font-family:inherit;color:var(--text);transition:0.2s;">‚Üê Back</button>';
        navHtml += '<button onclick="goRandom()" style="padding:12px 18px;background:var(--card-bg);border:1px solid var(--border);border-radius:10px;font-size:1.1rem;cursor:pointer;transition:0.2s;" title="Random Channel">üé≤</button>';
        navHtml += '<button onclick="goRandomArt()" style="padding:12px 18px;background:var(--card-bg);border:1px solid var(--border);border-radius:10px;font-size:1.1rem;cursor:pointer;transition:0.2s;" title="Random Art">üé®</button>';
        navHtml += '<button onclick="goRandomMeme()" style="padding:12px 18px;background:var(--card-bg);border:1px solid var(--border);border-radius:10px;font-size:1.1rem;cursor:pointer;transition:0.2s;" title="Random Meme">üòÇ</button>';
        navHtml += '<button onclick="go(\'' + nextId + '\')" style="padding:12px 24px;background:var(--accent);color:#fff;border:none;border-radius:10px;font-size:0.95rem;font-weight:700;cursor:pointer;font-family:inherit;transition:0.2s;">Next ‚Üí</button>';
        navHtml += '</div>';
        navHtml += '<div style="text-align:center;padding-bottom:20px;">';
        navHtml += '<button onclick="if(typeof startQuestManual===\'function\')startQuestManual()" style="padding:10px 20px;background:none;border:1px solid var(--border);border-radius:10px;color:var(--text-muted);font-size:0.85rem;cursor:pointer;font-family:inherit;transition:0.2s;">‚ö° Ready to test your knowledge? Start a Quest</button>';
        navHtml += '</div>';
        // Read Next suggestions
        if (typeof renderReadNext === 'function') {
            navHtml += renderReadNext(id);
        }
        msgsEl.innerHTML += navHtml;

        msgsEl.classList.add('fade-in');
    }

    // Twitter/X embed
    let twttrLoaded = false;
    function loadTweetEmbed(containerId, url) {
        const container = document.getElementById(containerId);
        if (!container) return;
        container.innerHTML = '<div class="tw-loading">Loading tweet...</div>';

        if (!twttrLoaded) {
            const s = document.createElement('script');
            s.src = 'https://platform.twitter.com/widgets.js';
            s.async = true;
            s.onload = function() { twttrLoaded = true; embedTweet(containerId, url); };
            document.head.appendChild(s);
        } else {
            embedTweet(containerId, url);
        }
    }

    function embedTweet(containerId, url) {
        const container = document.getElementById(containerId);
        if (!container) return;
        container.innerHTML = '';

        if (window.twttr && window.twttr.widgets) {
            const match = url.match(/status\/(\d+)/);
            if (match) {
                const tweetDiv = document.createElement('div');
                container.appendChild(tweetDiv);
                twttr.widgets.createTweet(match[1], tweetDiv, {
                    theme: document.body.getAttribute('data-theme') === 'light' ? 'light' : 'dark',
                    align: 'center',
                    conversation: 'none',
                    width: 500
                }).then(function(el) {
                    if (!el) {
                        container.innerHTML = '<div class="tw-embedded"><div class="tw-header">ùïè</div><div class="tw-body"><a class="msg-link" href="' + url + '" target="_blank">View on X ‚Üí</a></div></div>';
                    }
                });
            }
        } else {
            container.innerHTML = '<div class="tw-embedded"><div class="tw-header">ùïè</div><div class="tw-body"><a class="msg-link" href="' + url + '" target="_blank">View on X ‚Üí</a></div></div>';
        }
    }

    async function goRandom() {
        window._keepFloatingBtn = true;
        const keys = Object.keys(CHANNELS);
        if (!window._randomChannelHistory) window._randomChannelHistory = [];
        var avail = keys.filter(function(k) { return window._randomChannelHistory.indexOf(k) === -1; });
        if (avail.length === 0) { window._randomChannelHistory.length = 0; avail = keys; }
        const randomId = avail[Math.floor(Math.random() * avail.length)];
        window._randomChannelHistory.push(randomId);
        if (window._randomChannelHistory.length > Math.floor(keys.length * 0.3)) window._randomChannelHistory.shift();
        await go(randomId);
        window._keepFloatingBtn = false;
        showFloatingBtn('__random__', 'üé≤', 'Next Random Channel');
    }

    async function goRandomFromChannel(channelId, emoji, label) {
        window._keepFloatingBtn = true;
        const meta = CHANNELS[channelId];
        if (!meta) { window._keepFloatingBtn = false; return; }
        let d;
        if (channelCache[channelId]) {
            d = channelCache[channelId];
        } else {
            try {
                const resp = await fetch(meta.file);
                d = await resp.json();
                channelCache[channelId] = d;
            } catch(e) { return; }
        }

        // Find all messages that have images (skip first which is hero desc)
        const allMsgs = d.msgs.length > 1 ? d.msgs.slice(1) : d.msgs;
        const imgMsgs = [];
        allMsgs.forEach((m, i) => { if (m.imgs && m.imgs.length > 0) imgMsgs.push(i); });
        if (imgMsgs.length === 0) return;

        // Anti-repeat: track recent picks per channel, avoid them
        if (!window._randomHistory) window._randomHistory = {};
        if (!window._randomHistory[channelId]) window._randomHistory[channelId] = [];
        var history = window._randomHistory[channelId];
        // Keep history to ~20% of pool so we cycle through most before repeating
        var maxHistory = Math.min(Math.floor(imgMsgs.length * 0.2), 50);
        var available = imgMsgs.filter(function(idx) { return history.indexOf(idx) === -1; });
        if (available.length === 0) { history.length = 0; available = imgMsgs; } // Reset if exhausted
        var randomIdx = available[Math.floor(Math.random() * available.length)];
        history.push(randomIdx);
        if (history.length > maxHistory) history.shift();
        await go(channelId);

        const PAGE_SIZE = 50;
        if (randomIdx >= PAGE_SIZE) {
            const loadBtn = document.getElementById('loadMoreBtn');
            while (window._currentOffset <= randomIdx && loadBtn && document.contains(loadBtn)) {
                window.loadMoreMsgs();
            }
        }

        setTimeout(function() {
            const el = document.getElementById('msg-' + randomIdx);
            if (el) {
                el.scrollIntoView({ behavior: 'smooth', block: 'center' });
                el.style.transition = 'box-shadow 0.3s, border-color 0.3s';
                el.style.boxShadow = '0 0 20px rgba(247,147,26,0.4)';
                el.style.borderColor = '#f7931a';
                setTimeout(function() {
                    el.style.boxShadow = '';
                    el.style.borderColor = '';
                }, 2000);
                window._keepFloatingBtn = false;
                showFloatingBtn(channelId, emoji, label);
            }
        }, 300);
    }

    function goRandomMeme() { return goRandomFromChannel('memes-funny', 'üòÇ', 'Next Random Meme'); }
    function goRandomArt() { return goRandomFromChannel('art-inspiration', 'üé®', 'Next Random Art'); }

    function showFloatingBtn(channelId, emoji, label) {
        var btn = document.getElementById('floatingRandomBtn');
        if (!btn) {
            btn = document.createElement('button');
            btn.id = 'floatingRandomBtn';
            btn.style.cssText = 'position:fixed;bottom:80px;right:180px;z-index:150;padding:12px 20px;background:var(--accent);color:#fff;border:none;border-radius:12px;font-size:0.9rem;font-weight:700;cursor:pointer;font-family:inherit;box-shadow:0 4px 20px rgba(0,0,0,0.3);transition:0.2s;display:flex;align-items:center;gap:6px;';
            document.body.appendChild(btn);
        }
        btn.innerHTML = emoji + ' ' + label;
        btn.onclick = channelId === '__random__'
            ? function() { goRandom(); }
            : function() { goRandomFromChannel(channelId, emoji, label); };
        btn.style.display = 'flex';
        function hideOnNav() {
            btn.style.display = 'none';
            window.removeEventListener('popstate', hideOnNav);
        }
        window.addEventListener('popstate', hideOnNav, { once: true });
    }

    window.goRandomMeme = goRandomMeme;
    window.goRandomArt = goRandomArt;

    window.loadMoreGallery = function() {
        const imgs = window._galleryImgs;
        const offset = window._galleryOffset;
        const grid = document.querySelector('.gallery-grid');
        const btn = document.getElementById('loadMoreGallery');
        const next = imgs.slice(offset, offset + 100);

        next.forEach(img => {
            const el = document.createElement('img');
            el.src = img;
            el.loading = 'lazy';
            el.onclick = function() { openImg(this.src); };
            grid.appendChild(el);
        });

        window._galleryOffset = offset + 100;
        if (window._galleryOffset >= imgs.length) {
            btn.remove();
        } else {
            btn.textContent = 'Load more (' + (imgs.length - window._galleryOffset) + ' remaining)';
        }
    };

    function shareNostr(text, url) {
        const note = text + '\n\n' + url;
        // Copy to clipboard first
        navigator.clipboard.writeText(note).then(() => {
            showToast('üìã Note copied! Paste it in Primal to post.');
        }).catch(() => {});
        // Open Primal home where they can paste
        window.open('https://primal.net/home', '_blank');
    }

    function copyLink(url, btn) {
        navigator.clipboard.writeText(url).then(() => {
            btn.classList.add('copied');
            btn.textContent = '‚úÖ Copied!';
            setTimeout(() => { btn.classList.remove('copied'); btn.innerHTML = 'üîó Copy Link'; }, 2000);
        });
    }

    // goRandom defined above with floating button support

    let supportRevealed = false;
    function handleSupportClick() {
        const btn = document.getElementById('supportBtn');
        if (!supportRevealed) {
            // First click: reveal email with flash animation
            supportRevealed = true;
            btn.style.transition = '0.3s';
            btn.style.background = 'var(--accent)';
            btn.style.color = '#fff';
            btn.style.borderColor = 'var(--accent)';
            btn.innerHTML = 'üìß info.603btc.com@gmail.com <span style="font-size:0.7rem;opacity:0.8;margin-left:4px;">tap to copy</span>';
            setTimeout(function() {
                btn.style.background = 'var(--card-bg)';
                btn.style.color = 'var(--text)';
                btn.style.borderColor = 'var(--border)';
            }, 400);
        } else {
            // Second click: copy email and open mailto
            navigator.clipboard.writeText('info.603btc.com@gmail.com').then(function() {
                btn.innerHTML = '‚úÖ Copied!';
                btn.style.color = '#22c55e';
                setTimeout(function() {
                    btn.innerHTML = 'üìß info.603btc.com@gmail.com <span style="font-size:0.7rem;opacity:0.8;margin-left:4px;">tap to copy</span>';
                    btn.style.color = 'var(--text)';
                }, 1500);
            }).catch(function() {});
            window.location.href = 'mailto:info.603btc.com@gmail.com?subject=Support%20-%20Bitcoin%20Education%20Archive';
        }
    }

    function goHome(fromPopState) {
        var fb = document.getElementById('floatingRandomBtn');
        if (fb) fb.style.display = 'none';
        document.getElementById('home').classList.remove('hidden');
        document.getElementById('hero').innerHTML = '';
        document.getElementById('msgs').innerHTML = '';
        document.querySelectorAll('.ch-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('main').scrollTop = 0;
        if (!fromPopState) history.pushState({ channel: null }, '', window.location.pathname);
        if (isMobile()) document.getElementById('sidebar').classList.remove('open');
        // Show continue reading
        showContinueReading();
        // Refresh exploration map to reflect newly visited channels
        if (typeof renderExplorationMap === 'function') renderExplorationMap();
    }

    function showContinueReading() {
        const el = document.getElementById('continueReading');
        if (!el) return;
        const lastCh = localStorage.getItem('btc_last_channel');
        if (lastCh && CHANNELS[lastCh]) {
            const meta = CHANNELS[lastCh];
            el.style.display = 'block';
            el.innerHTML = '<div style="background:var(--card-bg);border:1px solid var(--accent-glow);border-radius:16px;padding:16px 20px;cursor:pointer;transition:0.2s;" onclick="go(\'' + lastCh + '\')" onmouseover="this.style.borderColor=\'var(--accent)\';this.style.boxShadow=\'0 4px 20px var(--accent-glow)\'" onmouseout="this.style.borderColor=\'var(--accent-glow)\';this.style.boxShadow=\'none\'">' +
                '<div style="font-size:0.7rem;text-transform:uppercase;letter-spacing:1.5px;color:var(--accent);font-weight:800;margin-bottom:6px;">üìñ Continue Reading</div>' +
                '<div style="color:var(--heading);font-size:1.05rem;font-weight:700;margin-bottom:2px;">' + meta.title + '</div>' +
                '<div style="color:var(--text-muted);font-size:0.8rem;">' + meta.cat + '</div></div>';
        } else {
            el.style.display = 'none';
        }
    }

    // Keyboard shortcuts (desktop)
    document.addEventListener('keydown', function(e) {
        // Don't fire in inputs
        if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
        // S = focus search
        if (e.key === 's' || e.key === '/') {
            e.preventDefault();
            var si = document.getElementById('searchInput');
            if (si) { si.focus(); if (isMobile()) document.getElementById('sidebar').classList.add('open'); }
        }
        // R = random channel
        if (e.key === 'r' && !e.ctrlKey && !e.metaKey) { goRandom(); }
        // H = go home
        if (e.key === 'h' && !e.ctrlKey && !e.metaKey) { goHome(); }
        // Escape = close modals
        if (e.key === 'Escape') {
            if (document.getElementById('lb').classList.contains('open')) document.getElementById('lb').classList.remove('open');
            if (document.getElementById('usernameModal').classList.contains('open')) hideUsernamePrompt();
            if (document.getElementById('questModal').classList.contains('open')) document.getElementById('questModal').classList.remove('open');
            if (isMobile() && document.getElementById('sidebar').classList.contains('open')) document.getElementById('sidebar').classList.remove('open');
        }
    });

    // Cache loaded channel data
    const channelCache = {};

    // Audio system
    let audioEnabled = localStorage.getItem('btc_audio') !== 'false';
    let audioVolume = parseFloat(localStorage.getItem('btc_volume') || '0.5');

    function getVolume() { return audioEnabled ? audioVolume : 0; }

    function playChannelSound() {
        if (!audioEnabled || audioVolume <= 0) return;
        try {
            const ctx = new (window.AudioContext || window.webkitAudioContext)();
            const vol = audioVolume;
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.connect(gain);
            gain.connect(ctx.destination);
            osc.frequency.value = 880;
            osc.type = 'sine';
            gain.gain.setValueAtTime(0.08 * vol, ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.15);
            osc.start(ctx.currentTime);
            osc.stop(ctx.currentTime + 0.15);
            const osc2 = ctx.createOscillator();
            const gain2 = ctx.createGain();
            osc2.connect(gain2);
            gain2.connect(ctx.destination);
            osc2.frequency.value = 1318.5;
            osc2.type = 'sine';
            gain2.gain.setValueAtTime(0.05 * vol, ctx.currentTime + 0.05);
            gain2.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.25);
            osc2.start(ctx.currentTime + 0.05);
            osc2.stop(ctx.currentTime + 0.25);
        } catch(e) {}
    }
    function toggleAudio() {
        audioEnabled = !audioEnabled;
        localStorage.setItem('btc_audio', audioEnabled);
        updateAudioUI();
        if (typeof showToast === 'function') showToast(audioEnabled ? 'üîä Sound on' : 'üîá Sound off');
    }
    function setVolume(val) {
        audioVolume = parseFloat(val);
        localStorage.setItem('btc_volume', audioVolume);
        if (audioVolume <= 0) {
            audioEnabled = false;
            localStorage.setItem('btc_audio', 'false');
        } else if (!audioEnabled) {
            audioEnabled = true;
            localStorage.setItem('btc_audio', 'true');
        }
        updateAudioUI();
    }
    function updateAudioUI() {
        const btn = document.getElementById('audioBtn');
        if (btn) btn.textContent = audioEnabled && audioVolume > 0 ? (audioVolume > 0.5 ? 'üîä' : 'üîâ') : 'üîá';
        const slider = document.getElementById('volumeSlider');
        if (slider) slider.value = audioEnabled ? audioVolume : 0;
    }

    async function go(id, btn, fromPopState) {
        const meta = CHANNELS[id];
        if (!meta) return;
        // Hide floating random button when navigating to a different channel
        if (!window._keepFloatingBtn) {
            var fb = document.getElementById('floatingRandomBtn');
            if (fb && fb.style.display !== 'none' && id !== 'memes-funny' && id !== 'art-inspiration') fb.style.display = 'none';
        }

        localStorage.setItem('btc_last_channel', id);
        playChannelSound();
        document.getElementById('home').classList.add('hidden');
        document.querySelectorAll('.ch-btn').forEach(b => b.classList.remove('active'));
        if (btn) { btn.classList.add('active'); expandCatForChannel(btn); }
        else {
            // Find the button by channel id and expand its section
            document.querySelectorAll('.ch-btn').forEach(b => {
                if (b.getAttribute('onclick') && b.getAttribute('onclick').indexOf("'" + id + "'") !== -1) {
                    b.classList.add('active');
                    expandCatForChannel(b);
                }
            });
        }

        // Show loading state
        // Check if this is an image-heavy channel
        const GALLERY_CHANNELS = ['graphics','memes-funny','art-inspiration','charts','swag-merch','fun-facts'];
        const isGallery = GALLERY_CHANNELS.includes(id);

        const shareUrl = 'https://bitcoineducation.quest/#' + id;
        const shareText = meta.title + ' ‚Äî Bitcoin Education Archive';
        document.getElementById('hero').innerHTML =
            '<div class="channel-logos">' +
                '<img src="images/btc-grad-logo.jpg" alt="" class="channel-logo-img">' +
                '<svg viewBox="0 0 64 64" width="50" height="50"><circle cx="32" cy="32" r="30" fill="#f7931a"/><polygon points="36,10 22,38 30,38 28,54 42,26 34,26" fill="#fff"/></svg>' +
            '</div>' +
            '<div class="cat">' + meta.cat + '</div>' +
            '<h1>' + meta.title + '</h1>' +
            '<p class="desc" id="channelDesc">' + meta.desc + '</p>' +
            '<div class="share-bar">' +
                '<a class="share-btn" href="https://twitter.com/intent/tweet?text=' + encodeURIComponent(shareText) + '&url=' + encodeURIComponent(shareUrl) + '" target="_blank">ùïè Share</a>' +
                '<button class="share-btn" onclick="shareNostr(\'' + shareText.replace(/'/g, "\\'") + '\', \'' + shareUrl + '\')">üü£ Nostr</button>' +
                '<button class="share-btn" onclick="copyLink(\'' + shareUrl + '\', this)">üîó Copy Link</button>' +
                '<button class="share-btn" id="favBtn" onclick="toggleFav(\'' + id + '\', this)">' + (getFavs().includes(id) ? '‚≠ê Saved' : '‚òÜ Save') + '</button>' +
            '</div>' +
            (isGallery ? '<button class="gallery-toggle" id="galleryBtn" style="display:inline-block;" onclick="toggleGallery(\'' + id + '\')">üñºÔ∏è Gallery View</button>' : '');
        document.getElementById('hero').classList.remove('fade-in');
        document.getElementById('msgs').innerHTML = '<div style="padding:40px;text-align:center;">' +
            '<div style="display:inline-block;width:32px;height:32px;border:3px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin 0.8s linear infinite;margin-bottom:12px;"></div>' +
            '<div style="color:var(--text-faint);font-size:0.85rem;">Loading channel...</div></div>';
        document.getElementById('main').scrollTop = 0;
        if (!fromPopState) history.pushState({ channel: id }, '', '#' + id);

        // On mobile, close the menu immediately
        if (isMobile()) {
            document.getElementById('sidebar').classList.remove('open');
        }

        // Fetch channel data (lazy load with cache)
        let d;
        if (channelCache[id]) {
            d = channelCache[id];
        } else {
            try {
                const resp = await fetch(meta.file);
                d = await resp.json();
                channelCache[id] = d;
            } catch(e) {
                document.getElementById('msgs').innerHTML = '<div style="padding:40px;color:#ef4444;">Error loading channel data</div>';
                return;
            }
        }

        // Store channel data and render
        currentChannelData = d;
        currentChannelId = id;
        galleryMode = false;

        // Update description with full text from data, with working links and embeds
        const descEl = document.getElementById('channelDesc');
        if (descEl && d.msgs && d.msgs[0] && d.msgs[0].text) {
            let t = d.msgs[0].text;
            // YouTube embeds
            let ytEmbeds = [];
            t = t.replace(/(?:https?:\/\/)?(?:www\.)?youtube\.com\/watch\?v=([\w-]+)(?:[&?][^\s]*)?/g, function(match, id) {
                ytEmbeds.push(id); return '%%YT' + (ytEmbeds.length - 1) + '%%';
            });
            t = t.replace(/(?:https?:\/\/)?youtu\.be\/([\w-]+)(?:\?[^\s]*)?/g, function(match, id) {
                ytEmbeds.push(id); return '%%YT' + (ytEmbeds.length - 1) + '%%';
            });
            // Twitter/X embeds
            let twEmbeds = [];
            t = t.replace(/(?:https?:\/\/)?(?:twitter\.com|x\.com)\/([\w]+)\/status\/(\d+)(?:[^\s]*)?/g, function(match) {
                var url = match.startsWith('http') ? match : 'https://' + match;
                twEmbeds.push(url); return '%%TW' + (twEmbeds.length - 1) + '%%';
            });
            // Linkify remaining URLs
            t = t.replace(/(https?:\/\/[^\s<>"]+)/g, '<a class="msg-link" href="$1" target="_blank">$1</a>');
            // Restore YouTube
            t = t.replace(/%%YT(\d+)%%/g, function(match, idx) {
                return '<div class="yt-embed"><iframe src="https://www.youtube-nocookie.com/embed/' + ytEmbeds[parseInt(idx)] + '" frameborder="0" allowfullscreen loading="lazy"></iframe></div>';
            });
            // Restore Twitter
            t = t.replace(/%%TW(\d+)%%/g, function(match, idx) {
                var twUrl = twEmbeds[parseInt(idx)], twId = 'tw_' + Math.random().toString(36).substr(2, 8);
                var isMob = typeof isMobile === 'function' && isMobile();
                var hm = twUrl.match(/(?:twitter\.com|x\.com)\/([\w]+)\//);
                var dh = hm ? '@' + hm[1] : twUrl.replace(/https?:\/\/(www\.)?/, '');
                return '<div class="tw-preview" id="' + twId + '" onclick="loadTweetEmbed(\'' + twId + '\',\'' + twUrl + '\')"><div class="tw-preview-icon">ùïè</div><div class="tw-preview-content"><div class="tw-preview-url">' + dh + '</div><div class="tw-preview-hint">' + (isMob ? '‚ñ∂ Tap to display tweet' : '‚ñ∂ Click to display tweet') + '</div></div><div class="tw-preview-arrow">‚Üí</div></div>';
            });
            t = t.replace(/üü† (.+)/g, '<span class="orange-glow">$1</span>');
            descEl.innerHTML = t;
        }

        renderContent(id);

        // Trigger fade-in animation
        document.getElementById('hero').classList.add('fade-in');
        document.getElementById('msgs').classList.add('fade-in');

        // Setup load-more for list view (skip first msg, shown in hero)
        window._currentMsgs = d.msgs.length > 1 ? d.msgs.slice(1) : d.msgs;
        window._currentOffset = 50;
        window.loadMoreMsgs = function() {
            const offset = window._currentOffset;
            const msgs = window._currentMsgs;
            const btn = document.getElementById('loadMoreBtn');
            const nextBatch = msgs.slice(offset, offset + 50);
            let html = '';
            nextBatch.forEach((m, bi) => {
                html += '<div class="msg" id="msg-' + (offset + bi) + '">';
                if (m.text) { let t = m.text; let yt=[],tw=[]; t=t.replace(/(?:https?:\/\/)?(?:www\.)?youtube\.com\/watch\?v=([\w-]+)(?:[&?][^\s]*)?/g,function(m,id){yt.push(id);return '%%YT'+(yt.length-1)+'%%';}); t=t.replace(/(?:https?:\/\/)?youtu\.be\/([\w-]+)(?:\?[^\s]*)?/g,function(m,id){yt.push(id);return '%%YT'+(yt.length-1)+'%%';}); t=t.replace(/(?:https?:\/\/)?(?:twitter\.com|x\.com)\/([\w]+)\/status\/(\d+)(?:[^\s]*)?/g,function(m){var u=m.startsWith('http')?m:'https://'+m;tw.push(u);return '%%TW'+(tw.length-1)+'%%';}); t=t.replace(/(https?:\/\/[^\s<>"]+)/g,'<a class="msg-link" href="$1" target="_blank">$1</a>'); t=t.replace(/%%YT(\d+)%%/g,function(m,i){return '<div class="yt-embed"><iframe src="https://www.youtube-nocookie.com/embed/'+yt[parseInt(i)]+'" frameborder="0" allowfullscreen loading="lazy"></iframe></div>';}); t=t.replace(/%%TW(\d+)%%/g,function(m,i){var u=tw[parseInt(i)],tid='tw_'+Math.random().toString(36).substr(2,8),mob=typeof isMobile==='function'&&isMobile(),hm=u.match(/(?:twitter\.com|x\.com)\/([\w]+)\//),dh=hm?'@'+hm[1]:u.replace(/https?:\/\/(www\.)?/,'');return '<div class="tw-preview" id="'+tid+'" onclick="loadTweetEmbed(\''+tid+'\',\''+u+'\')"><div class="tw-preview-icon">ùïè</div><div class="tw-preview-content"><div class="tw-preview-url">'+dh+'</div><div class="tw-preview-hint">'+(mob?'‚ñ∂ Tap to display tweet':'‚ñ∂ Click to display tweet')+'</div></div><div class="tw-preview-arrow">‚Üí</div></div>';}); t=t.replace(/üü† (.+)/g,'<span class="orange-glow">$1</span>'); html += '<div class="msg-text">' + t + '</div>'; }
                if (m.imgs) m.imgs.forEach(img => { if (m.link) { html += '<a href="' + m.link + '" target="_blank" style="display:block;"><img class="msg-img" src="' + img + '" loading="lazy" title="Click to open source"></a>'; } else { html += '<img class="msg-img" src="' + img + '" onclick="openImg(this.src)" loading="lazy">'; } });
                html += '</div>';
            });
            btn.insertAdjacentHTML('beforebegin', html);
            window._currentOffset = offset + 50;
            if (window._currentOffset >= msgs.length) { btn.remove(); }
            else { btn.textContent = 'Load more (' + (msgs.length - window._currentOffset) + ' remaining)'; }
        };

        // Mark channel as visited in sidebar
        document.querySelectorAll('.ch-btn').forEach(b => {
            if (b.getAttribute('onclick') && b.getAttribute('onclick').includes("'" + id + "'")) {
                b.classList.add('visited');
            }
        });

        // Save visited channels locally
        let visited = JSON.parse(localStorage.getItem('btc_visited_channels') || '[]');
        if (!visited.includes(id)) { visited.push(id); localStorage.setItem('btc_visited_channels', JSON.stringify(visited)); }

        // Ranking: award points for opening channel
        if (typeof onChannelOpen === 'function') onChannelOpen(id);
    }

    // Search index cache for deep search
    let searchIndexLoaded = false;
    let searchFullData = {};

    async function loadSearchIndex() {
        if (searchIndexLoaded) return;
        // Load all data files in background for deep search
        const promises = Object.entries(CHANNELS).map(async ([key, meta]) => {
            if (channelCache[key]) { searchFullData[key] = channelCache[key]; return; }
            try {
                const resp = await fetch(meta.file);
                const d = await resp.json();
                channelCache[key] = d;
                searchFullData[key] = d;
            } catch(e) {}
        });
        await Promise.all(promises);
        searchIndexLoaded = true;
    }

    let searchTimeout = null;
    function doSearch(q) {
        const sr = document.getElementById('searchResults');
        const cl = document.getElementById('channelList');
        if (!q || q.length < 2) {
            sr.classList.remove('active');
            sr.innerHTML = '';
            cl.style.display = '';
            return;
        }
        q = q.toLowerCase();
        cl.style.display = 'none';
        sr.classList.add('active');

        // Instant: search channel titles from index
        let results = [];
        for (const [key, meta] of Object.entries(CHANNELS)) {
            if (meta.title.toLowerCase().includes(q) || meta.desc.toLowerCase().includes(q)) {
                results.push({key, title: meta.title, cat: meta.cat, match: 'Channel match'});
            }
        }

        renderSearchResults(results, sr);

        // Deep search: load full data and search message content (debounced)
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(async () => {
            await loadSearchIndex();
            let deepResults = [];
            for (const [key, d] of Object.entries(searchFullData)) {
                const meta = CHANNELS[key];
                if (!meta) continue;
                // Skip if already found by title
                if (results.some(r => r.key === key)) continue;
                for (const m of (d.msgs || [])) {
                    if (m.text && m.text.toLowerCase().includes(q)) {
                        let idx = m.text.toLowerCase().indexOf(q);
                        let start = Math.max(0, idx - 30);
                        let snippet = (start > 0 ? '...' : '') + m.text.substring(start, idx + q.length + 30).replace(/<[^>]+>/g, '') + '...';
                        deepResults.push({key, title: meta.title, cat: meta.cat, match: snippet});
                        break;
                    }
                }
            }
            renderSearchResults([...results, ...deepResults], sr);
        }, 500);
    }

    function renderSearchResults(results, sr) {
        if (results.length === 0) {
            sr.innerHTML = '<div style="padding:16px;color:#475569;text-align:center;">No results found</div>';
            return;
        }
        sr.innerHTML = results.slice(0, 30).map(r =>
            '<div class="sr-item" onclick="selectResult(\'' + r.key + '\')">' +
            '<div class="sr-cat">' + r.cat + '</div>' +
            '<div>' + r.title + '</div>' +
            '<div class="sr-match">' + r.match + '</div></div>'
        ).join('');
    }

    function selectResult(key) {
        document.getElementById('searchInput').value = '';
        doSearch('');
        go(key);
    }

    // Unique visit counter via Firebase
    (function() {
        const vc = document.getElementById('visitCount');
        function updateVisitDisplay() {
            if (typeof firebase === 'undefined' || !firebase.firestore) return;
            const fdb = firebase.firestore();
            const today = new Date().toISOString().split('T')[0];
            const visitorId = localStorage.getItem('btc_visitor_id') || ('v_' + Math.random().toString(36).substr(2, 12));
            localStorage.setItem('btc_visitor_id', visitorId);

            // Check if this visitor already counted today
            const visitRef = fdb.collection('visits').doc(visitorId);
            visitRef.get().then(doc => {
                if (!doc.exists || doc.data().lastVisit !== today) {
                    // New unique visit ‚Äî increment counter and mark visitor
                    const counterRef = fdb.collection('stats').doc('visits');
                    fdb.runTransaction(t => {
                        return t.get(counterRef).then(counterDoc => {
                            const newCount = (counterDoc.exists ? counterDoc.data().total : 0) + 1;
                            t.set(counterRef, { total: newCount });
                            t.set(visitRef, { lastVisit: today });
                            return newCount;
                        });
                    }).then(newCount => {
                        vc.textContent = newCount.toLocaleString();
                    });
                } else {
                    // Already counted today ‚Äî just display current total
                    fdb.collection('stats').doc('visits').get().then(d => {
                        if (d.exists) vc.textContent = (d.data().total || 0).toLocaleString();
                    });
                }
            }).catch(() => { vc.textContent = '‚Äî'; });
        }
        // Wait a moment for Firebase to init
        setTimeout(updateVisitDisplay, 2000);
    })();

    // Suggest a topic
    function expandSuggest() {
        const fields = document.getElementById('suggestFields');
        if (fields.style.display === 'none') {
            fields.style.display = 'block';
        } else {
            fields.style.display = 'none';
        }
    }

    let lastSuggestionTime = 0;
    async function submitSuggestion() {
        // Rate limit suggestions to 1 per 30 seconds
        const now = Date.now();
        if (now - lastSuggestionTime < 30000) {
            document.getElementById('suggestStatus').innerHTML = '<span style="color:#ef4444;">Please wait before submitting another suggestion.</span>';
            return;
        }
        lastSuggestionTime = now;
        const name = typeof sanitizeInput === 'function' ? sanitizeInput(document.getElementById('suggestName').value.trim()) : document.getElementById('suggestName').value.trim();
        const text = typeof sanitizeInput === 'function' ? sanitizeInput(document.getElementById('suggestText').value.trim()) : document.getElementById('suggestText').value.trim();
        const status = document.getElementById('suggestStatus');
        const btn = document.querySelector('.suggest-submit');

        if (!text) { status.innerHTML = '<span style="color:#ef4444;">Please enter a suggestion!</span>'; return; }

        btn.disabled = true;
        btn.textContent = 'Submitting...';
        try {
            if (typeof firebase !== 'undefined' && firebase.firestore) {
                await firebase.firestore().collection('suggestions').add({
                    name: name || 'Anonymous',
                    suggestion: text,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
            }
            status.innerHTML = '<span style="color:#22c55e;">‚úÖ Thank you! Your suggestion has been submitted.</span>';
            document.getElementById('suggestName').value = '';
            document.getElementById('suggestText').value = '';
            btn.textContent = 'Submitted!';
            setTimeout(() => { btn.textContent = 'Submit Suggestion'; btn.disabled = false; }, 3000);
        } catch(e) {
            status.innerHTML = '<span style="color:#ef4444;">Error submitting. Please try again.</span>';
            btn.textContent = 'Submit Suggestion';
            btn.disabled = false;
        }
    }

    // Daily featured channel
    (function() {
        const keys = Object.keys(CHANNELS);
        // Use day of year as seed for deterministic daily rotation
        const now = new Date();
        const dayOfYear = Math.floor((now - new Date(now.getFullYear(), 0, 0)) / 86400000);
        const dailyKey = keys[dayOfYear % keys.length];
        const ch = CHANNELS[dailyKey];
        if (ch) {
            const el = document.getElementById('dailyChannel');
            el.innerHTML = '<div class="daily-label">üìÖ Channel of the Day</div>' +
                '<div class="daily-title">' + ch.title + '</div>' +
                '<div class="daily-desc">' + ch.desc + '</div>';
            el.onclick = () => go(dailyKey);
        }
    })();

    // Reading progress bar + back to top
    document.getElementById('main').addEventListener('scroll', function() {
        const el = this;
        const pct = el.scrollTop / (el.scrollHeight - el.clientHeight) * 100;
        document.getElementById('progressBar').style.width = Math.min(100, Math.max(0, pct)) + '%';
        document.getElementById('backToTop').classList.toggle('visible', el.scrollTop > 400);
        var nearBottom = el.scrollTop + el.clientHeight >= el.scrollHeight - 200;
        document.getElementById('scrollToBottom').classList.toggle('visible', !nearBottom);
    });

    window.onload = () => {
        // Restore visited channel checkmarks
        const visited = JSON.parse(localStorage.getItem('btc_visited_channels') || '[]');
        visited.forEach(id => {
            document.querySelectorAll('.ch-btn').forEach(b => {
                if (b.getAttribute('onclick') && b.getAttribute('onclick').includes("'" + id + "'")) {
                    b.classList.add('visited');
                }
            });
        });

        renderFavs();
        showContinueReading();

        // Handle browser back/forward buttons
        window.addEventListener('popstate', function(e) {
            const hash = location.hash.slice(1);
            if (hash) {
                go(hash, null, true);
            } else {
                goHome(true);
            }
        });

        const h = location.hash.slice(1);
        if (h) go(h);
    };
    </script>
<div id="recaptcha-container"></div>
<script>
if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
        navigator.serviceWorker.register('/sw.js').catch(function() {});
    });
}
</script>
</body>
</html>
<!-- v1771873982 -->
