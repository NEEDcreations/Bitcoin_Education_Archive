<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A curated Bitcoin education archive with 146 topics, 8800+ messages, and 3000+ images â€” for the world.">
    <meta name="theme-color" content="#020617">
    <link rel="preconnect" href="https://www.gstatic.com" crossorigin>
    <link rel="preload" href="channel_index.js" as="script">

    <!-- Open Graph / Twitter Cards -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://bitcoineducation.quest">
    <meta property="og:title" content="Bitcoin Education Archive">
    <meta property="og:description" content="A curated library of 146 topics, 8,800+ messages, and 3,000+ images â€” Bitcoin education for the world.">
    <meta property="og:image" content="https://bitcoineducation.quest/og-image.png">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Bitcoin Education Archive">
    <meta name="twitter:description" content="A curated library of 146 topics, 8,800+ messages, and 3,000+ images â€” Bitcoin education for the world.">
    <meta name="twitter:image" content="https://bitcoineducation.quest/og-image.png">

    <title>Bitcoin Education Archive</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html, body { overflow-x: hidden; }
        img { max-width: 100%; height: auto; }
        
        /* Theme Variables */
        :root {
            --bg: #020617; --bg-side: #0f172a; --border: #1e293b;
            --text: #e2e8f0; --text-dim: #94a3b8; --text-muted: #64748b; --text-faint: #475569;
            --accent: #f97316; --accent-bg: rgba(249,115,22,0.15); --accent-glow: rgba(249,115,22,0.3);
            --heading: #fff; --link: #38bdf8;
            --input-bg: #020617; --msg-border: rgba(255,255,255,0.03);
            --card-bg: rgba(255,255,255,0.03); --overlay: rgba(0,0,0,0.92);
        }
        [data-theme="light"] {
            --bg: #f8fafc; --bg-side: #ffffff; --border: #e2e8f0;
            --text: #1e293b; --text-dim: #475569; --text-muted: #64748b; --text-faint: #94a3b8;
            --accent: #ea580c; --accent-bg: rgba(234,88,12,0.1); --accent-glow: rgba(234,88,12,0.2);
            --heading: #0f172a; --link: #2563eb;
            --input-bg: #f1f5f9; --msg-border: rgba(0,0,0,0.06);
            --card-bg: rgba(0,0,0,0.03); --overlay: rgba(255,255,255,0.95);
        }

        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; display: flex; height: 100vh; overflow: hidden; transition: background 0.3s, color 0.3s; }
        
        /* Theme Toggle */
        .theme-toggle { background: none; border: 1px solid var(--border); color: var(--text-dim); width: 36px; height: 36px; border-radius: 8px; cursor: pointer; font-size: 1.1rem; display: flex; align-items: center; justify-content: center; transition: 0.2s; flex-shrink: 0; margin-left: 10px; }
        .theme-toggle:hover { border-color: var(--accent); color: var(--accent); }

        /* Sidebar */
        aside { width: 320px; background: var(--bg-side); border-right: 1px solid var(--border); display: flex; flex-direction: column; flex-shrink: 0; transition: background 0.3s; }
        .sidebar-header { padding: 24px 20px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; }
        .sidebar-header h2 { color: var(--accent); font-size: 1rem; text-transform: uppercase; letter-spacing: 1.5px; font-weight: 900; line-height: 1.3; }
        .sidebar-header p { color: var(--text-muted); font-size: 0.75rem; margin-top: 4px; }
        .channels { flex: 1; overflow-y: auto; padding: 12px; }
        .search-box { padding: 12px; border-bottom: 1px solid var(--border); }
        .search-input { width: 100%; padding: 10px 14px; background: var(--input-bg); border: 1px solid var(--border); border-radius: 8px; color: var(--text); font-size: 0.9rem; font-family: inherit; outline: none; }
        .search-input:focus { border-color: var(--accent); }
        .random-btn { background: var(--input-bg); border: 1px solid var(--border); border-radius: 8px; font-size: 1.2rem; width: 44px; cursor: pointer; transition: 0.2s; }
        .random-btn:hover { border-color: var(--accent); transform: rotate(15deg); }
        .search-input::placeholder { color: var(--text-faint); }
        .search-results { padding: 12px; display: none; overflow-y: auto; flex: 1; background: var(--bg-side); }
        .search-results.active { display: block; }
        .sr-item { padding: 10px 14px; border-radius: 8px; cursor: pointer; color: var(--text-dim); font-size: 0.9rem; margin-bottom: 4px; border-left: 3px solid transparent; transition: 0.15s; }
        .sr-item:hover, .sr-item:active { background: var(--accent-bg); color: var(--heading); border-left-color: var(--accent); }
        .sr-item .sr-cat { font-size: 0.65rem; color: var(--text-faint); text-transform: uppercase; letter-spacing: 1px; }
        .sr-item .sr-match { color: var(--accent); font-size: 0.8rem; margin-top: 4px; line-height: 1.4; }
        .cat-label { font-size: 0.65rem; text-transform: uppercase; color: var(--text-faint); letter-spacing: 2px; margin: 20px 0 8px 12px; font-weight: 800; }
        .ch-btn { display: block; width: 100%; text-align: left; background: none; border: none; color: var(--text-dim); padding: 10px 14px; border-radius: 6px; cursor: pointer; transition: 0.15s; font-size: 0.9rem; font-family: inherit; }
        .ch-btn:hover { background: var(--card-bg); color: var(--text); }
        .ch-btn.active { background: var(--accent-bg); color: var(--accent); font-weight: 700; }
        .ch-btn.visited::after { content: " âœ“"; color: #22c55e; font-size: 0.75rem; font-weight: 800; }
        .ch-btn::before { content: "# "; color: var(--text-faint); font-weight: 700; }
        
        /* Main */
        main { flex: 1; overflow-y: auto; }
        
        /* Smooth page transitions */
        @keyframes fadeSlideIn { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in { animation: fadeSlideIn 0.35s ease-out; }

        .hero { padding: 80px 60px 40px; max-width: 950px; margin: 0 auto; }
        .hero .cat { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 2px; color: var(--accent); font-weight: 800; margin-bottom: 12px; }
        .hero h1 { font-size: 2.4rem; font-weight: 900; color: var(--heading); letter-spacing: -0.5px; line-height: 1.25; margin-bottom: 16px; }
        .hero .desc { color: var(--text-muted); font-size: 1rem; border-bottom: 1px solid var(--border); padding-bottom: 30px; margin-bottom: 0; }
        
        /* Messages */
        .messages { max-width: 950px; margin: 0 auto; padding: 0 60px 80px; overflow-x: hidden; }
        .msg { padding: 20px 0; border-bottom: 1px solid var(--msg-border); }
        .msg-text { color: var(--text); font-size: 1.05rem; line-height: 1.8; white-space: pre-wrap; word-wrap: break-word; overflow-wrap: break-word; word-break: break-word; max-width: 100%; }
        .msg-text strong, .msg-text b { color: var(--heading); }
        .yt-embed { position: relative; width: 100%; max-width: 560px; padding-bottom: min(315px, 56.25%); height: 0; overflow: hidden; border-radius: 12px; margin: 12px 0; }
        .yt-embed iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border-radius: 12px; }
        .orange-glow { color: #f7931a; font-weight: 700; font-size: 1.1em; text-shadow: 0 0 20px rgba(247,147,26,0.4); padding: 16px 20px; margin-top: 8px; background: rgba(247,147,26,0.08); border: 1px solid rgba(247,147,26,0.25); border-radius: 12px; display: block; }
        .msg-img { max-width: 100%; border-radius: 12px; margin-top: 14px; border: 1px solid var(--border); cursor: pointer; transition: 0.2s; }
        .msg-img:hover { border-color: var(--accent); box-shadow: 0 8px 30px var(--accent-glow); }
        .msg-link { color: var(--link); text-decoration: none; word-break: break-all; }
        .msg-link:hover { text-decoration: underline; }
        /* Back to top */
        .back-to-top { position: fixed; bottom: 30px; right: 190px; width: 44px; height: 44px; border-radius: 50%; background: var(--accent); color: #fff; border: none; font-size: 1.3rem; cursor: pointer; z-index: 50; opacity: 0; transform: translateY(10px); transition: 0.3s; pointer-events: none; box-shadow: 0 4px 15px var(--accent-glow); }
        .back-to-top.visible { opacity: 1; transform: translateY(0); pointer-events: auto; }
        .back-to-top:hover { transform: translateY(-3px); box-shadow: 0 8px 25px var(--accent-glow); }

        /* Reading progress bar */
        .progress-bar { position: fixed; top: 0; left: 0; width: 0%; height: 3px; background: linear-gradient(90deg, #eab308, #f97316); z-index: 300; transition: width 0.15s; pointer-events: none; }
        @media (max-width: 900px) { .progress-bar { top: 52px; } }

        /* Share buttons */
        .share-bar { display: flex; gap: 8px; margin-top: 16px; flex-wrap: wrap; }
        .share-btn { display: inline-flex; align-items: center; gap: 6px; padding: 8px 14px; border-radius: 8px; font-size: 0.8rem; font-weight: 600; text-decoration: none; cursor: pointer; border: 1px solid var(--border); background: var(--card-bg); color: var(--text-dim); font-family: inherit; transition: 0.2s; }
        .share-btn:hover { border-color: var(--accent); color: var(--accent); }
        .share-btn.copied { background: var(--accent); color: #fff; border-color: var(--accent); }

        /* Image gallery mode */
        .gallery-toggle { display: none; padding: 8px 14px; border-radius: 8px; border: 1px solid var(--border); background: var(--card-bg); color: var(--text-dim); font-size: 0.8rem; font-weight: 600; cursor: pointer; font-family: inherit; transition: 0.2s; margin-top: 12px; }
        .gallery-toggle:hover { border-color: var(--accent); color: var(--accent); }
        .gallery-toggle.active { background: var(--accent-bg); border-color: var(--accent); color: var(--accent); }
        .gallery-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 8px; padding: 20px 0; }
        @media (max-width: 900px) { .gallery-grid { grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); gap: 6px; } }
        .gallery-grid img { width: 100%; aspect-ratio: 1; object-fit: cover; border-radius: 8px; cursor: pointer; border: 1px solid var(--border); transition: 0.2s; }
        .gallery-grid img:hover { border-color: var(--accent); transform: scale(1.03); box-shadow: 0 4px 15px var(--accent-glow); }

        .load-more-btn { display: block; width: 100%; padding: 16px; margin: 30px 0; background: var(--accent-bg); border: 1px solid var(--accent-glow); border-radius: 12px; color: var(--accent); font-size: 1rem; font-weight: 700; cursor: pointer; font-family: inherit; transition: 0.2s; }
        .load-more-btn:hover { background: var(--accent-glow); }
        .msg-img { content-visibility: auto; }
        
        /* Sidebar Promo */
        .quest-start-btn { display: block; width: calc(100% - 24px); margin: 8px 12px; padding: 10px; background: var(--accent-bg); border: 1px solid var(--accent-glow); border-radius: 8px; color: var(--accent); font-size: 0.85rem; font-weight: 700; cursor: pointer; font-family: inherit; transition: 0.2s; text-align: center; }
        .quest-start-btn:hover { background: var(--accent); color: #fff; }

        .sidebar-promo { display: block; text-align: center; padding: 12px; color: var(--text-faint); font-size: 0.8rem; text-decoration: none; border-top: 1px solid var(--border); transition: 0.2s; letter-spacing: 0.5px; }
        .sidebar-promo:hover { color: var(--accent); background: var(--accent-bg); }

        /* Ranking Bar */
        #rankBar { display: none; flex-direction: column; padding: 12px 20px; border-top: 1px solid var(--border); background: var(--bg); cursor: pointer; }
        .rank-info { display: flex; align-items: center; gap: 10px; }
        .rank-level { font-weight: 800; font-size: 0.9rem; color: var(--accent); }
        .rank-user { color: var(--text-dim); font-size: 0.85rem; }
        .rank-pts { margin-left: auto; color: var(--accent); font-weight: 700; font-size: 0.85rem; }
        .rank-progress { height: 4px; background: var(--border); border-radius: 4px; margin-top: 8px; overflow: hidden; }
        .rank-progress-fill { height: 100%; background: linear-gradient(90deg, #f97316, #eab308); border-radius: 4px; transition: width 0.5s; }
        .rank-next { font-size: 0.7rem; color: var(--text-faint); margin-top: 4px; }

        /* Toasts */
        .rank-toast { position: fixed; bottom: 30px; right: 30px; background: #f97316; color: #fff; padding: 12px 20px; border-radius: 10px; font-size: 0.9rem; font-weight: 700; z-index: 300; opacity: 0; transform: translateY(20px); transition: 0.3s; pointer-events: none; box-shadow: 0 8px 25px rgba(249,115,22,0.3); }
        .rank-toast.show { opacity: 1; transform: translateY(0); }

        /* Leaderboard */
        #leaderboard { display: none; position: fixed; right: 20px; bottom: 20px; width: 340px; max-height: 70vh; background: var(--bg-side); border: 1px solid var(--border); border-radius: 16px; z-index: 150; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.5); transition: 0.3s; }
        #leaderboard.open { display: block; animation: fadeSlideIn 0.3s ease-out; }
        #leaderboard.minimized { max-height: 48px; overflow: hidden; border-radius: 24px; width: auto; cursor: pointer; }
        .lb-min-bar { display: none; padding: 12px 18px; font-size: 0.85rem; font-weight: 700; color: var(--accent); text-align: center; }
        #leaderboard.minimized .lb-min-bar { display: block; }
        #leaderboard.minimized .lb-header, #leaderboard.minimized .lb-list, #leaderboard.minimized .lb-levels { display: none; }
        @media (max-width: 900px) { #leaderboard { right: 10px; left: 10px; bottom: 10px; width: auto; } }
        .lb-header { display: flex; justify-content: space-between; align-items: center; padding: 16px 20px; border-bottom: 1px solid var(--border); }
        .lb-header h3 { color: var(--heading); font-size: 1.1rem; }
        .lb-header div { display: flex; align-items: center; }
        .lb-close { background: none; border: 1px solid var(--border); color: var(--text-dim); font-size: 1.1rem; cursor: pointer; width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; transition: 0.2s; }
        .lb-close:hover { border-color: var(--accent); color: var(--accent); }
        .lb-list { padding: 8px; }
        .lb-row { display: flex; align-items: center; gap: 10px; padding: 10px 12px; border-radius: 8px; }
        .lb-row:hover { background: var(--card-bg); }
        .lb-me { background: var(--accent-bg); border: 1px solid var(--accent-glow); }
        .lb-rank { font-size: 0.9rem; min-width: 30px; color: var(--text-muted); }
        .lb-name { color: var(--text); font-size: 0.9rem; flex: 1; }
        .lb-score { color: var(--accent); font-weight: 700; font-size: 0.85rem; }
        .lb-levels { padding: 12px 20px; border-top: 1px solid var(--border); }
        .lb-levels h4 { color: var(--text-faint); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; }
        .lb-level-row { display: flex; justify-content: space-between; padding: 4px 0; color: var(--text-muted); font-size: 0.8rem; }

        /* Username Modal */
        #usernameModal { display: none; position: fixed; inset: 0; background: var(--overlay); z-index: 250; justify-content: center; align-items: center; }
        #usernameModal.open { display: flex; }
        .username-box { background: var(--bg-side); border: 1px solid var(--border); border-radius: 20px; padding: 40px; max-width: 400px; width: 90%; text-align: center; }
        .username-box h2 { color: #fff; margin-bottom: 8px; font-size: 1.5rem; }
        .username-box p { color: #64748b; margin-bottom: 24px; font-size: 0.95rem; }
        .username-box input { width: 100%; padding: 14px 18px; background: #020617; border: 1px solid var(--border); border-radius: 10px; color: #fff; font-size: 1rem; font-family: inherit; outline: none; margin-bottom: 16px; text-align: center; }
        .username-box input:focus { border-color: var(--accent); }
        .username-box button { background: #f97316; color: #fff; border: none; padding: 14px 30px; border-radius: 10px; font-size: 1rem; font-weight: 700; cursor: pointer; font-family: inherit; width: 100%; }
        .username-box button:hover { background: #ea580c; }
        .username-box .skip { color: #475569; font-size: 0.85rem; margin-top: 12px; cursor: pointer; display: block; }
        .username-box .skip:hover { color: var(--text-dim); }

        @media (max-width: 900px) {
            #leaderboard { right: 10px; left: 10px; bottom: 70px; width: auto; }
            #lbFloatBtn { bottom: 70px !important; right: 16px !important; padding: 10px 14px !important; font-size: 0.85rem !important; z-index: 140; }
            .rank-toast { right: 15px; bottom: 80px; font-size: 0.8rem; }
        }

        /* Badge Toast */
        .badge-toast { position: fixed; bottom: 30px; left: 30px; display: flex; gap: 14px; align-items: center; background: var(--bg-side); border: 1px solid #22c55e; padding: 16px 20px; border-radius: 14px; z-index: 300; opacity: 0; transform: translateY(20px); transition: 0.4s; box-shadow: 0 8px 30px rgba(34,197,94,0.2); }
        .badge-toast.show { opacity: 1; transform: translateY(0); }
        .badge-toast-emoji { font-size: 2rem; }
        .badge-toast-title { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1px; color: #22c55e; font-weight: 800; }
        .badge-toast-name { color: var(--heading); font-weight: 700; font-size: 1rem; }
        .badge-toast-desc { color: var(--text-muted); font-size: 0.8rem; }

        /* Badges Grid */
        .badges-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(90px, 1fr)); gap: 10px; padding: 12px; }
        .badge-item { text-align: center; padding: 12px 6px; border-radius: 12px; border: 1px solid var(--border); background: var(--card-bg); transition: 0.2s; position: relative; cursor: pointer; }
        .badge-item.earned { border-color: var(--accent-glow); }
        .badge-item.locked { opacity: 0.4; }
        .badge-item:hover { opacity: 1; transform: translateY(-2px); }
        .badge-emoji { font-size: 1.5rem; margin-bottom: 4px; }
        .badge-name { font-size: 0.65rem; color: var(--text-dim); font-weight: 600; }
        .badge-tooltip { display: none; position: absolute; bottom: calc(100% + 8px); left: 50%; transform: translateX(-50%); background: var(--bg-side); border: 1px solid var(--border); color: var(--text); padding: 8px 12px; border-radius: 8px; font-size: 0.75rem; white-space: nowrap; z-index: 160; box-shadow: 0 4px 15px rgba(0,0,0,0.3); pointer-events: none; }
        .badge-tooltip::after { content: ''; position: absolute; top: 100%; left: 50%; transform: translateX(-50%); border: 6px solid transparent; border-top-color: var(--border); }
        .badge-item:hover .badge-tooltip { display: block; }
        @keyframes badgeBounce { 0% { transform: scale(0); } 50% { transform: scale(1.3); } 70% { transform: scale(0.9); } 100% { transform: scale(1); } }

        /* Quest Modal */
        #questModal { display: none; position: fixed; inset: 0; background: var(--overlay); z-index: 260; justify-content: center; align-items: center; overflow-y: auto; padding: 20px; }
        #questModal.open { display: flex; }
        #questInner { background: var(--bg-side); border: 1px solid var(--border); border-radius: 20px; padding: 40px; max-width: 550px; width: 100%; max-height: 90vh; overflow-y: auto; }
        .quest-header { text-align: center; margin-bottom: 30px; }
        .quest-badge { display: inline-block; background: var(--accent); color: #fff; padding: 6px 16px; border-radius: 20px; font-size: 0.8rem; font-weight: 800; letter-spacing: 1px; margin-bottom: 12px; }
        .quest-header h2 { color: var(--heading); font-size: 1.5rem; margin-bottom: 8px; }
        .quest-header p { color: var(--text-muted); font-size: 0.9rem; }
        .quest-q { margin-bottom: 24px; }
        .quest-q-num { color: var(--accent); font-weight: 800; font-size: 0.75rem; margin-bottom: 6px; }
        .quest-q-text { color: var(--heading); font-size: 1.05rem; font-weight: 600; margin-bottom: 12px; line-height: 1.4; }
        .quest-options { display: flex; flex-direction: column; gap: 8px; }
        .quest-opt { background: var(--card-bg); border: 1px solid var(--border); border-radius: 10px; padding: 12px 16px; color: var(--text); font-size: 0.95rem; cursor: pointer; text-align: left; font-family: inherit; transition: 0.15s; }
        .quest-opt:hover { border-color: var(--accent); }
        .quest-opt.selected { background: var(--accent-bg); border-color: var(--accent); color: var(--accent); font-weight: 700; }
        .quest-opt.correct { background: rgba(34,197,94,0.15); border-color: #22c55e; color: #22c55e; }
        .quest-opt.wrong { background: rgba(239,68,68,0.15); border-color: #ef4444; color: #ef4444; }
        .quest-opt:disabled { cursor: default; opacity: 0.8; }
        .quest-submit { width: 100%; padding: 16px; background: var(--accent); color: #fff; border: none; border-radius: 12px; font-size: 1.05rem; font-weight: 700; cursor: pointer; font-family: inherit; margin-top: 20px; transition: 0.2s; }
        .quest-submit:disabled { opacity: 0.4; cursor: not-allowed; }
        .quest-submit:not(:disabled):hover { filter: brightness(1.1); }
        .quest-skip { width: 100%; padding: 12px; background: none; border: none; color: var(--text-faint); font-size: 0.9rem; cursor: pointer; font-family: inherit; margin-top: 8px; }
        .quest-skip:hover { color: var(--text-dim); }
        .quest-result { text-align: center; margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--border); }
        .quest-result-msg { font-size: 1.3rem; font-weight: 800; color: var(--heading); margin-bottom: 20px; }
        .quest-retry { width: 100%; padding: 14px; background: var(--accent-bg); border: 1px solid var(--accent); border-radius: 12px; color: var(--accent); font-size: 1rem; font-weight: 700; cursor: pointer; font-family: inherit; margin-bottom: 10px; }
        .quest-done { width: 100%; padding: 14px; background: var(--accent); border: none; border-radius: 12px; color: #fff; font-size: 1rem; font-weight: 700; cursor: pointer; font-family: inherit; }

        /* Home Page */
        .home-page { display: flex; animation: fadeSlideIn 0.4s ease-out; align-items: center; justify-content: center; min-height: 100vh; text-align: center; padding: 60px 30px; background: radial-gradient(ellipse at 30% 20%, rgba(249,115,22,0.08) 0%, transparent 60%), radial-gradient(ellipse at 70% 80%, rgba(121,45,228,0.06) 0%, transparent 60%); }
        .home-page.hidden { display: none; }
        .home-inner { max-width: 650px; }
        .home-logos { display: flex; align-items: center; justify-content: center; gap: 20px; margin-bottom: 40px; }
        .home-btc { filter: drop-shadow(0 0 30px rgba(247,147,26,0.4)); }
        .home-ln { filter: drop-shadow(0 0 30px rgba(121,45,228,0.4)); }
        .home-title { font-size: 3.5rem; font-weight: 900; color: var(--heading); letter-spacing: -2px; line-height: 1.1; margin-bottom: 20px; -webkit-text-stroke: 1px var(--accent); }
        .home-subtitle { font-size: 1.2rem; color: #64748b; margin-bottom: 40px; line-height: 1.6; }
        .home-credits { background: rgba(255,255,255,0.03); border: 1px solid var(--border); border-radius: 16px; padding: 24px 30px; margin-bottom: 40px; text-align: left; }
        .home-credits p { color: var(--text-dim); font-size: 1rem; margin-bottom: 8px; line-height: 1.6; }
        .home-credits p:last-child { margin-bottom: 0; }
        .home-credits strong { color: var(--accent); }
        .home-stats { display: flex; justify-content: center; gap: 40px; margin-bottom: 40px; }
        .home-stat { display: flex; flex-direction: column; align-items: center; }
        .home-stat-num { font-size: 2rem; font-weight: 900; color: var(--accent); }
        .home-stat-label { font-size: 0.8rem; color: #475569; text-transform: uppercase; letter-spacing: 1px; margin-top: 4px; }
        .daily-channel { background: var(--card-bg); border: 1px solid var(--border); border-radius: 16px; padding: 20px 24px; margin-bottom: 30px; cursor: pointer; transition: 0.2s; text-align: left; }
        .daily-channel:hover { border-color: var(--accent); box-shadow: 0 4px 20px var(--accent-glow); }
        .daily-label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1.5px; color: var(--accent); font-weight: 800; margin-bottom: 8px; }
        .daily-title { color: var(--heading); font-size: 1.15rem; font-weight: 700; margin-bottom: 4px; }
        .daily-desc { color: var(--text-muted); font-size: 0.85rem; line-height: 1.4; }

        .home-cta { background: var(--accent); color: #fff; border: none; padding: 22px 60px; border-radius: 16px; font-size: 1.4rem; font-weight: 800; cursor: pointer; font-family: inherit; transition: 0.2s; letter-spacing: 0.5px; box-shadow: 0 4px 20px var(--accent-glow); margin-bottom: 30px; }
        .home-cta:hover { background: #ea580c; transform: translateY(-3px); box-shadow: 0 12px 40px rgba(249,115,22,0.4); }
        .suggest-box { background: var(--card-bg); border: 1px solid var(--border); border-radius: 16px; padding: 24px; margin-bottom: 30px; text-align: left; }
        .suggest-input { width: 100%; padding: 10px 14px; background: var(--input-bg); border: 1px solid var(--border); border-radius: 8px; color: var(--text); font-size: 0.9rem; font-family: inherit; outline: none; margin-bottom: 10px; resize: vertical; }
        .suggest-input:focus { border-color: var(--accent); }
        .suggest-input::placeholder { color: var(--text-faint); }
        .suggest-submit { width: 100%; padding: 12px; background: var(--accent); color: #fff; border: none; border-radius: 10px; font-size: 0.95rem; font-weight: 700; cursor: pointer; font-family: inherit; transition: 0.2s; }
        .suggest-submit:hover { filter: brightness(1.1); }
        .suggest-submit:disabled { opacity: 0.5; cursor: not-allowed; }
        #suggestStatus { text-align: center; margin-top: 10px; font-size: 0.85rem; }

        .home-footer { margin-top: 30px; color: #334155; font-size: 0.85rem; }

        @media (max-width: 900px) {
            .home-title { font-size: 2.4rem; }
            .home-stats { gap: 24px; }
            .home-stat-num { font-size: 1.5rem; }
        }

        /* Lightbox */
        .lightbox { display: none; position: fixed; inset: 0; background: var(--overlay); z-index: 200; justify-content: center; align-items: center; cursor: zoom-out; }
        .lightbox.open { display: flex; }
        .lightbox img { max-width: 90vw; max-height: 90vh; border-radius: 8px; }
        
        /* Mobile nav bar */
        .mobile-bar { display: none; }

        /* Mobile */
        @media (max-width: 900px) {
            aside { display: none; position: fixed; inset: 0; z-index: 100; width: 100%; max-width: 100%; }
            aside.open { display: flex; }
            body { flex-direction: column; }
            main { flex: 1; overflow-y: auto; }
            .hero { padding: 30px 20px 20px; }
            .hero h1 { font-size: 1.6rem; }
            .messages { padding: 0 20px 60px; }
            .mobile-bar { display: flex; align-items: center; justify-content: space-between; padding: 14px 20px; background: var(--bg-side); border-bottom: 1px solid var(--border); flex-shrink: 0; }
            .mobile-bar h2 { color: var(--accent); font-size: 1rem; font-weight: 900; text-transform: uppercase; letter-spacing: 1px; }
            .mobile-bar button { background: none; border: 1px solid var(--border); color: var(--text-dim); padding: 8px 14px; border-radius: 8px; font-size: 0.85rem; cursor: pointer; font-family: inherit; }
            .mobile-bar button:active { background: rgba(249,115,22,0.15); color: var(--accent); border-color: var(--accent); }
            .mobile-close { position: absolute; top: 16px; right: 16px; background: var(--bg-side); border: 1px solid var(--border); color: var(--text-dim); font-size: 1.2rem; cursor: pointer; z-index: 101; line-height: 1; width: 36px; height: 36px; border-radius: 8px; display: flex; align-items: center; justify-content: center; }
            .theme-toggle { position: absolute; top: 16px; right: 60px; }
            .hero { padding: 24px 16px 16px; }
            .hero h1 { font-size: 1.4rem; }
            .messages { padding: 0 16px 100px; }
            .msg-text { font-size: 0.95rem; }
            .msg-img { max-width: 100%; height: auto; }
            .msg-link { font-size: 0.85rem; }
            .share-bar { gap: 6px; }
            .share-btn { padding: 6px 10px; font-size: 0.75rem; }
            .back-to-top { bottom: 70px; left: 16px; right: auto; width: 38px; height: 38px; font-size: 1.1rem; }
            .home-title { font-size: 2rem; }
            .home-stats { gap: 16px; flex-wrap: wrap; }
            .home-stat-num { font-size: 1.3rem; }
            .home-credits { padding: 16px; }
            .home-credits p { font-size: 0.85rem; }
            .daily-channel { padding: 14px; }
            .home-cta { padding: 14px 30px; font-size: 1rem; }
            .quest-start-btn { margin: 6px 10px; }
        }
    </style>
</head>
<body>
    <!-- Mobile top bar -->
    <div class="mobile-bar">
        <div onclick="goHome()" style="cursor:pointer;display:flex;align-items:center;gap:10px;">
            <svg viewBox="0 0 64 64" width="28" height="28" style="flex-shrink:0;"><circle cx="32" cy="32" r="30" fill="#f7931a"/><text x="32" y="44" text-anchor="middle" font-size="36" font-weight="bold" fill="#fff" font-family="Arial,sans-serif">B</text><line x1="28" y1="12" x2="28" y2="52" stroke="#fff" stroke-width="3"/><line x1="36" y1="12" x2="36" y2="52" stroke="#fff" stroke-width="3"/></svg>
            <h2 style="margin:0;line-height:1.2;">BITCOIN<br>EDUCATION ARCHIVE</h2>
        </div>
        <button onclick="toggleMenu()">â˜° Menu</button>
    </div>

    <aside id="sidebar">
        <button class="mobile-close" onclick="toggleMenu()">âœ•</button>
        <div class="sidebar-header">
            <div onclick="goHome()" style="cursor:pointer;display:flex;align-items:center;gap:10px;">
                <svg viewBox="0 0 64 64" width="28" height="28" style="flex-shrink:0;"><circle cx="32" cy="32" r="30" fill="#f7931a"/><text x="32" y="44" text-anchor="middle" font-size="36" font-weight="bold" fill="#fff" font-family="Arial,sans-serif">B</text><line x1="28" y1="12" x2="28" y2="52" stroke="#fff" stroke-width="3"/><line x1="36" y1="12" x2="36" y2="52" stroke="#fff" stroke-width="3"/></svg>
                <h2 style="margin:0;line-height:1.2;">BITCOIN<br>EDUCATION ARCHIVE</h2>
            </div>
            <button class="theme-toggle" onclick="toggleTheme()" title="Toggle light/dark mode" id="themeBtn">ğŸŒ™</button>
        </div>
        <div class="search-box">
            <div style="display:flex;gap:8px;">
                <input type="text" class="search-input" id="searchInput" placeholder="ğŸ” Search all channels..." oninput="doSearch(this.value)" style="flex:1;">
                <button class="random-btn" onclick="goRandom()" title="Random channel">ğŸ²</button>
            </div>
        </div>
        <div class="search-results" id="searchResults"></div>
        <div class="channels" id="channelList">
            <div id="favsSection" style="display:none;">
                <div class="cat-label">â­ Your Saved Channels</div>
                <div id="favsList"></div>
            </div>
            <div class="cat-label">Properties Layer 1</div>
            <button class="ch-btn active" onclick="go('whitepaper',this)">ğŸ“„ whitepaper</button>
            <button class="ch-btn" onclick="go('decentralized',this)">ğŸ‘ª decentralized-censorship-resistant</button>
            <button class="ch-btn" onclick="go('scarce',this)">ğŸ€ scarce-unforgeable</button>
            <button class="ch-btn" onclick="go('secure',this)">â„¢ secure-fungible</button>
            <button class="ch-btn" onclick="go('money',this)">ğŸ’° money-deflationary</button>
            <button class="ch-btn" onclick="go('peaceful',this)">â˜® peaceful-neutral</button>
            <button class="ch-btn" onclick="go('dominant',this)">ğŸ† dominant-recognizable</button>
            <button class="ch-btn" onclick="go('organic',this)">ğŸŒ³ organic-empowering</button>
            <button class="ch-btn" onclick="go('supranational',this)">ğŸ•Š supranational-lindy</button>
            <button class="ch-btn" onclick="go('programmable',this)">ğŸ¤– programable-interoperable</button>
            <button class="ch-btn" onclick="go('use-cases',this)">âœ” use-cases</button>

            <div class="cat-label">Experienced Topics</div>
            <button class="ch-btn" onclick="go('maximalism',this)">ğŸ’¯ maximalism</button>
            <button class="ch-btn" onclick="go('problems-of-money',this)">ğŸ“‰ problems-of-money</button>
            <button class="ch-btn" onclick="go('self-custody',this)">ğŸ”‘ self-custody-security</button>
            <button class="ch-btn" onclick="go('privacy-nonkyc',this)">ğŸ¤« privacy-nonkyc</button>
            <button class="ch-btn" onclick="go('nodes',this)">ğŸ’» nodes</button>
            <button class="ch-btn" onclick="go('mining',this)">ğŸŒ‹ mining</button>
            <button class="ch-btn" onclick="go('pow-vs-pos',this)">ğŸ’ª pow-vs-pos</button>
            <button class="ch-btn" onclick="go('energy',this)">ğŸ’¡ energy</button>
            <button class="ch-btn" onclick="go('difficulty-adjustment',this)">ğŸ˜¤ difficulty-adjustment</button>
            <button class="ch-btn" onclick="go('layer-2-lightning',this)">âš¡ layer-2-lightning</button>
            <button class="ch-btn" onclick="go('fedi-ark',this)">ğŸ›¡ fedi-ark</button>
            <button class="ch-btn" onclick="go('chaumian-mints',this)">ğŸ’¸ chaumian-mints-ecash</button>
            <button class="ch-btn" onclick="go('ctv-covenants',this)">ğŸ“œ ctv-bip119-covenants</button>
            <button class="ch-btn" onclick="go('extension-blocks',this)">ğŸš§ extension-blocks</button>
            <button class="ch-btn" onclick="go('op-codes',this)">ğŸ‘¨â€ğŸ’» op-codes-simplicity</button>
            <button class="ch-btn" onclick="go('bitvm',this)">ğŸ–¥ bitvm</button>
            <button class="ch-btn" onclick="go('layer-3-sidechains',this)">ğŸ“± layer-3-sidechains</button>
            <button class="ch-btn" onclick="go('stablecoins',this)">ğŸª™ stablecoins</button>
            <button class="ch-btn" onclick="go('smart-contracts',this)">ğŸ“± smart-contracts</button>
            <button class="ch-btn" onclick="go('blockchain-timechain',this)">â›“ blockchain-timechain</button>
            <button class="ch-btn" onclick="go('regulation',this)">ğŸ› regulation-policy</button>
            <button class="ch-btn" onclick="go('cryptography',this)">ğŸ”’ cryptography-cypherpunks</button>
            <button class="ch-btn" onclick="go('core-source-code',this)">ğŸ’¾ core-source-code</button>
            <button class="ch-btn" onclick="go('developers',this)">ğŸ–¥ developers</button>
            <button class="ch-btn" onclick="go('investment-strategy',this)">ğŸ¤‘ investment-strategy</button>
            <button class="ch-btn" onclick="go('evidence-against-alts',this)">âš  evidence-against-alts</button>
            <button class="ch-btn" onclick="go('consensus',this)">ğŸŒ consensus</button>

            <div class="cat-label">Resources</div>
            <button class="ch-btn" onclick="go('one-stop-shop',this)">ğŸ›‘ one-stop-shop</button>
            <button class="ch-btn" onclick="go('faq-glossary',this)">â“ faq-glossary</button>
            <button class="ch-btn" onclick="go('nostr',this)">ğŸ’œ nostr</button>
            <button class="ch-btn" onclick="go('misconceptions-fud',this)">ğŸ¤¡ misconceptions-fud</button>
            <button class="ch-btn" onclick="go('books',this)">ğŸ“š books</button>
            <button class="ch-btn" onclick="go('videos',this)">ğŸ“º videos</button>
            <button class="ch-btn" onclick="go('podcasts',this)">ğŸ”Š podcasts</button>
            <button class="ch-btn" onclick="go('articles-threads',this)">ğŸ“ƒ articles-threads</button>
            <button class="ch-btn" onclick="go('informational-sites',this)">ğŸ“ƒ informational-sites</button>
            <button class="ch-btn" onclick="go('curriculum',this)">ğŸ“ curriculum</button>
            <button class="ch-btn" onclick="go('research-theses',this)">âœ research-theses</button>
            <button class="ch-btn" onclick="go('games',this)">ğŸ® games</button>
            <button class="ch-btn" onclick="go('music',this)">ğŸµ music</button>
            <button class="ch-btn" onclick="go('movies-tv',this)">ğŸ¬ movies-tv</button>
            <button class="ch-btn" onclick="go('hardware',this)">ğŸ’» hardware</button>
            <button class="ch-btn" onclick="go('poems-stories',this)">ğŸ“’ poems-stories</button>
            <button class="ch-btn" onclick="go('apps-tools',this)">ğŸ apps-tools</button>
            <button class="ch-btn" onclick="go('projects-diy',this)">ğŸ”§ projects-diy</button>
            <button class="ch-btn" onclick="go('art-inspiration',this)">ğŸ¤© art-inspiration</button>
            <button class="ch-btn" onclick="go('graphics',this)">ğŸ¨ graphics</button>
            <button class="ch-btn" onclick="go('charts',this)">ğŸ“Š charts</button>
            <button class="ch-btn" onclick="go('swag-merch',this)">ğŸ‘• swag-merch</button>
            <button class="ch-btn" onclick="go('jobs-earn',this)">ğŸ‘· jobs-earn</button>
            <button class="ch-btn" onclick="go('social-media',this)">ğŸ‘ social-media</button>
            <button class="ch-btn" onclick="go('fun-facts',this)">ğŸ‰ fun-facts</button>
            <button class="ch-btn" onclick="go('news-adoption',this)">ğŸ“° news-adoption</button>
            <button class="ch-btn" onclick="go('history',this)">ğŸ“† history</button>
            <button class="ch-btn" onclick="go('international',this)">ğŸŒ international</button>
            <button class="ch-btn" onclick="go('satoshi-nakamoto',this)">ğŸ¦¸ satoshi-nakamoto</button>
            <button class="ch-btn" onclick="go('giga-chad',this)">ğŸ‘‘ giga-chad</button>
            <button class="ch-btn" onclick="go('health',this)">ğŸ¥© health</button>
            <button class="ch-btn" onclick="go('web5',this)">5âƒ£ web5</button>
            <button class="ch-btn" onclick="go('memes-funny',this)">ğŸ˜‚ memes-funny</button>

            <div class="cat-label">Additional Info</div>
            <button class="ch-btn" onclick="go('100_sats',this)">ğŸ’¯ 100 Sats</button>
            <button class="ch-btn" onclick="go('analogies',this)">ğŸ”‹ Analogies</button>
            <button class="ch-btn" onclick="go('austrian_school_of_economics',this)">ğŸ‡¦ğŸ‡¹ Austrian School</button>
            <button class="ch-btn" onclick="go('bip119',this)">ğŸš§ BIP119</button>
            <button class="ch-btn" onclick="go('bitcoin_exam',this)">ğŸ“ Bitcoin Exam</button>
            <button class="ch-btn" onclick="go('bitcoin_vs_real_estate',this)">ğŸ  Bitcoin vs Real Estate</button>
            <button class="ch-btn" onclick="go('block_time-block-size',this)">â° Block Time-Block-Size</button>
            <button class="ch-btn" onclick="go('burn_bitcoin',this)">ğŸ”¥ Burn Bitcoin</button>
            <button class="ch-btn" onclick="go('byzantine_generals__problem',this)">âš” Byzantine Generals</button>
            <button class="ch-btn" onclick="go('chaumian_e-cash_and_blind_signatures',this)">ğŸ’² Chaumian E-cash</button>
            <button class="ch-btn" onclick="go('coin_mixing_coinjoin_coin_control_utxo',this)">ğŸŒ€ Coin Mixing/Coinjoin</button>
            <button class="ch-btn" onclick="go('consensus',this)">ğŸ¤ Consensus</button>
            <button class="ch-btn" onclick="go('cyles',this)">ğŸš² Cycles</button>
            <button class="ch-btn" onclick="go('derivation_path',this)">â†• Derivation Path</button>
            <button class="ch-btn" onclick="go('discrete_log_contracts__dlcs',this)">ğŸ“ DLCs</button>
            <button class="ch-btn" onclick="go('dollar-bitcoin_milkshake_theory',this)">ğŸ¥¤ Dollar-Bitcoin Milkshake Theory</button>
            <button class="ch-btn" onclick="go('dust',this)">â³ Dust</button>
            <button class="ch-btn" onclick="go('elevator_pitches',this)">â†• Elevator Pitches</button>
            <button class="ch-btn" onclick="go('environment___energy',this)">ğŸŒ³ Environment & Energy</button>
            <button class="ch-btn" onclick="go('faith___religion',this)">ğŸ™ Faith & Religion</button>
            <button class="ch-btn" onclick="go('fedimints',this)">ğŸ’š Fedimints</button>
            <button class="ch-btn" onclick="go('feedback_loops',this)">â° Feedback Loops</button>
            <button class="ch-btn" onclick="go('1_first_principles',this)">1âƒ£ First Principles</button>
            <button class="ch-btn" onclick="go('free_and_open_source_software__foss',this)">ğŸ’¿ FOSS</button>
            <button class="ch-btn" onclick="go('game_theory',this)">ğŸˆ Game Theory</button>
            <button class="ch-btn" onclick="go('geopolitics___macroeconomics',this)">ğŸ’° Geopolitics</button>
            <button class="ch-btn" onclick="go('governance',this)">ğŸ› Governance</button>
            <button class="ch-btn" onclick="go('ham_radio',this)">ğŸ“» Ham Radio</button>
            <button class="ch-btn" onclick="go('human_rights__social_justice_and_freedo',this)">ğŸ—½ Human Rights</button>
            <button class="ch-btn" onclick="go('improved_incentive_structure',this)">âœ… Incentive Structure</button>
            <button class="ch-btn" onclick="go('laws_of_thermodynamics',this)">ğŸ”¥ Laws of Thermodynamics</button>
            <button class="ch-btn" onclick="go('lightning_node',this)">âš¡ Lightning Node</button>
            <button class="ch-btn" onclick="go('lindy_effect',this)">ğŸ‘´ Lindy Effect</button>
            <button class="ch-btn" onclick="go('market_cap',this)">ğŸ§¢ Market Cap</button>
            <button class="ch-btn" onclick="go('math',this)">â• Math</button>
            <button class="ch-btn" onclick="go('mathematics',this)">â• Mathematics</button>
            <button class="ch-btn" onclick="go('mev',this)">â› MEV</button>
            <button class="ch-btn" onclick="go('0_mining__hashing',this)">0âƒ£ Mining (Hashing)</button>
            <button class="ch-btn" onclick="go('network_effects',this)">ğŸŒ Network Effects</button>
            <button class="ch-btn" onclick="go('open_source',this)">â­• Open Source</button>
            <button class="ch-btn" onclick="go('oracle',this)">ğŸ”® Oracle</button>
            <button class="ch-btn" onclick="go('orange-pilling',this)">ğŸŸ  Orange-Pilling</button>
            <button class="ch-btn" onclick="go('ordinals',this)">ğŸ”¢ Ordinals</button>
            <button class="ch-btn" onclick="go('ordinals__nfts_on_bitcoin__and_block_spa',this)">ğŸ”¢ Ordinals & Block Space</button>
            <button class="ch-btn" onclick="go('peace_and_anti-war',this)">â˜® Peace and Anti-War</button>
            <button class="ch-btn" onclick="go('philosophy',this)">ğŸ Philosophy</button>
            <button class="ch-btn" onclick="go('politics',this)">ğŸ› Politics</button>
            <button class="ch-btn" onclick="go('predictions',this)">ğŸ”® Predictions</button>
            <button class="ch-btn" onclick="go('public_key_vs_private_key',this)">ğŸ— Public vs Private Key</button>
            <button class="ch-btn" onclick="go('rbf',this)">â†” RBF</button>
            <button class="ch-btn" onclick="go('risks__threats__attack_vectors__weaknes',this)">âš” Risks & Threats</button>
            <button class="ch-btn" onclick="go('rollups',this)">ğŸ¥ Rollups</button>
            <button class="ch-btn" onclick="go('sats__or__bits',this)">ğŸ’¬ Sats or Bits?</button>
            <button class="ch-btn" onclick="go('scalability',this)">ğŸŒ Scalability</button>
            <button class="ch-btn" onclick="go('sidechains',this)">â™» Sidechains</button>
            <button class="ch-btn" onclick="go('soft_vs_hard_forks',this)">ğŸ´ Soft vs Hard Forks</button>
            <button class="ch-btn" onclick="go('softwar',this)">ğŸ“– Softwar</button>
            <button class="ch-btn" onclick="go('2__solved_technical_problems',this)">2âƒ£ Solved Problems</button>
            <button class="ch-btn" onclick="go('simplified_payment_verification__spv',this)">âœ” SPV</button>
            <button class="ch-btn" onclick="go('stablecoins',this)">ğŸª™ Stablecoins</button>
            <button class="ch-btn" onclick="go('stratum_v2',this)">ğŸŸ© Stratum V2</button>
            <button class="ch-btn" onclick="go('submarine_swap',this)">â›µ Submarine Swap</button>
            <button class="ch-btn" onclick="go('swaps',this)">â†” Swaps</button>
            <button class="ch-btn" onclick="go('tail_emission',this)">ğŸˆ Tail Emission</button>
            <button class="ch-btn" onclick="go('taproot',this)">ğŸ§° Taproot</button>
            <button class="ch-btn" onclick="go('taro',this)">ğŸ¥• Taro</button>
            <button class="ch-btn" onclick="go('the_future',this)">ğŸ”® The Future</button>
            <button class="ch-btn" onclick="go('time',this)">â° Time</button>
            <button class="ch-btn" onclick="go('time_preference',this)">ğŸ•‘ Time Preference</button>
            <button class="ch-btn" onclick="go('toxicity',this)">â˜£ Toxicity</button>
            <button class="ch-btn" onclick="go('transaction_fees',this)">ğŸ’² Transaction Fees</button>
            <button class="ch-btn" onclick="go('unpopular_opinions',this)">ğŸ’€ Unpopular Opinions</button>
            <button class="ch-btn" onclick="go('utxos',this)">ğŸ•³ UTXOs</button>
            <button class="ch-btn" onclick="go('vbyte',this)">ğŸ‹ vByte</button>

            <div class="cat-label">Referral Links</div>
            <button class="ch-btn" onclick="go('referral-links',this)">ğŸ”— free-btc-referral-links</button>
        </div>
        <button class="quest-start-btn" onclick="startQuestManual()">âš¡ Start a Quest</button>
        <button class="quest-start-btn" onclick="startScholarQuest()" style="background:linear-gradient(135deg,#f7931a,#ea580c);margin-top:4px;">ğŸ“ Scholar Certification</button>
        <a href="https://603btc.com" target="_blank" class="sidebar-promo">âš¡ Powered by 603btc.com</a>
        <div id="rankBar"></div>
    </aside>
    <div class="progress-bar" id="progressBar"></div>
    <button class="back-to-top" id="backToTop" onclick="document.getElementById('main').scrollTo({top:0,behavior:'smooth'})">â†‘</button>
    <main id="main">
        <!-- Home / Landing -->
        <div id="home" class="home-page">
            <div class="home-inner">
                <div class="home-logos">
                    <svg class="home-btc" viewBox="0 0 64 64" width="80" height="80"><circle cx="32" cy="32" r="30" fill="#f7931a"/><text x="32" y="43" text-anchor="middle" font-size="34" font-weight="bold" fill="#fff" font-family="Arial">â‚¿</text></svg>
                    <svg class="home-ln" viewBox="0 0 64 64" width="80" height="80"><circle cx="32" cy="32" r="30" fill="#792de4"/><polygon points="36,10 22,38 30,38 28,54 42,26 34,26" fill="#fff"/></svg>
                </div>
                <h1 class="home-title">Bitcoin Education<br>Archive</h1>
                <p class="home-subtitle">A curated library of Bitcoin education</p>
                <div class="home-stats">
                    <div class="home-stat"><span class="home-stat-num">146</span><span class="home-stat-label">Channels</span></div>
                    <div class="home-stat"><span class="home-stat-num">8,800+</span><span class="home-stat-label">Messages</span></div>
                    <div class="home-stat"><span class="home-stat-num">3,000+</span><span class="home-stat-label">Images</span></div>
                    <div class="home-stat"><span class="home-stat-num" id="visitCount">â€”</span><span class="home-stat-label">Total Visits</span></div>
                </div>
                <button class="home-cta" onclick="go('whitepaper')">Start Exploring â†’</button>
                <button onclick="showUsernamePrompt()" style="display:inline-block;margin-top:12px;padding:12px 30px;background:none;border:2px solid var(--accent);color:var(--accent);border-radius:12px;font-size:1rem;font-weight:700;cursor:pointer;font-family:inherit;transition:0.2s;" onmouseover="this.style.background='var(--accent)';this.style.color='#fff'" onmouseout="this.style.background='none';this.style.color='var(--accent)'">Create Account / Sign In</button>
                <div id="newbieBtnWrap" style="margin-top:16px;">
                    <button id="newbieBtn" onclick="document.getElementById('newbieMsg').style.display='block';this.style.display='none';" style="padding:10px 24px;background:none;border:1px solid var(--border);color:var(--text-muted);border-radius:10px;font-size:0.9rem;cursor:pointer;font-family:inherit;transition:0.2s;">ğŸŸ¢ Brand new to Bitcoin?</button>
                    <div id="newbieMsg" style="display:none;margin-top:12px;padding:16px 20px;background:var(--card-bg);border:1px solid var(--border);border-radius:12px;color:var(--text);font-size:0.95rem;line-height:1.5;">
                        We built a channel just for you. Visit <a href="#one-stop-shop" onclick="go('one-stop-shop');return false;" style="color:var(--accent);font-weight:700;text-decoration:underline;cursor:pointer;">one-stop-shop</a> to hit the highlights of Bitcoin.
                    </div>
                </div>
                <div style="margin-top:20px;padding:16px 20px;background:var(--card-bg);border:1px solid var(--border);border-radius:12px;text-align:center;">
                    <div style="font-size:1.5rem;margin-bottom:6px;">ğŸ“</div>
                    <div style="color:var(--heading);font-weight:700;font-size:1rem;margin-bottom:4px;">Bitcoin Scholar Certification</div>
                    <p style="color:var(--text-muted);font-size:0.85rem;margin-bottom:12px;">Think you know Bitcoin? Take the 25-question timed exam to earn your certificate.</p>
                    <button onclick="startScholarQuest()" style="padding:10px 24px;background:linear-gradient(135deg,#f7931a,#ea580c);color:#fff;border:none;border-radius:10px;font-size:0.9rem;font-weight:700;cursor:pointer;font-family:inherit;">Take the Exam â†’</button>
                </div>
                <div class="daily-channel" id="dailyChannel"></div>
                <div class="suggest-box" onclick="expandSuggest()" id="suggestBox" style="cursor:pointer;">
                    <h3 style="color:var(--heading);font-size:1rem;margin-bottom:8px;">ğŸ’¡ Suggest a Topic</h3>
                    <p style="color:var(--text-muted);font-size:0.85rem;margin-bottom:0;">Want to see something added to the archive? Let us know!</p>
                    <div id="suggestFields" style="display:none;margin-top:12px;">
                        <input type="text" id="suggestName" placeholder="Your name (optional)" class="suggest-input" onclick="event.stopPropagation()">
                        <textarea id="suggestText" placeholder="What topic or content should we add?" class="suggest-input" rows="3" onclick="event.stopPropagation()"></textarea>
                        <button class="suggest-submit" onclick="event.stopPropagation();submitSuggestion()">Submit Suggestion</button>
                        <div id="suggestStatus"></div>
                    </div>
                </div>
                <div class="home-credits">
                    <p><strong>Lead Curator:</strong> Pleb "NEEDcreations" Phil</p>
                    <p><strong>Other Contributors:</strong> Hundreds of Bitcoiners from Bitcoin Twitter, Bitcoin X, and the Bitcoin Education Discord community</p>
                </div>
                <p class="home-footer">Open source Â· Free forever Â· Built on GitHub Pages</p>
            </div>
        </div>
        <div class="hero" id="hero"></div>
        <div class="messages" id="msgs"></div>
    </main>
    <div class="lightbox" id="lb" onclick="this.classList.remove('open')"><img id="lb-img"></div>
    <div id="questModal"><div id="questInner"></div></div>
    <button id="lbFloatBtn" onclick="toggleLeaderboard()" style="position:fixed;bottom:20px;right:20px;z-index:140;background:var(--accent);color:#fff;border:none;border-radius:14px;padding:12px 18px;font-size:0.9rem;font-weight:700;cursor:pointer;font-family:inherit;box-shadow:0 4px 20px rgba(0,0,0,0.3);display:flex;align-items:center;gap:6px;transition:0.2s;">ğŸ† Leaderboard</button>
    <div id="leaderboard"></div>
    <div id="usernameModal">
        <div class="username-box">
            <h2>âš¡ Join the Leaderboard</h2>
            <p>Pick a username to start earning points as you explore the archive!</p>
            <input type="text" id="usernameInput" placeholder="Enter a username..." maxlength="20" onkeydown="if(event.key==='Enter')submitUsername()">
            <input type="email" id="emailInput" placeholder="ğŸ“§ Email (optional)" style="margin-top:0;">
            <p style="color:#475569;font-size:0.75rem;margin:-8px 0 16px;">We'll never spam you. Only used if we launch future Bitcoin education updates.</p>
            <button onclick="submitUsername()">Start Learning â†’</button>
            <div style="margin-top:12px;padding-top:12px;border-top:1px solid var(--border);">
                <p style="color:var(--text-faint);font-size:0.75rem;margin-bottom:8px;">Or sign in to sync across devices:</p>
                <button onclick="signInWithGoogle()" style="width:100%;padding:12px;background:var(--card-bg);border:1px solid var(--border);border-radius:10px;color:var(--text);font-size:0.9rem;cursor:pointer;font-family:inherit;display:flex;align-items:center;justify-content:center;gap:8px;transition:0.2s;margin-bottom:6px;">
                    <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="18" height="18"> Sign in with Google
                </button>
                <button onclick="signInWithTwitter()" style="width:100%;padding:12px;background:var(--card-bg);border:1px solid var(--border);border-radius:10px;color:var(--text);font-size:0.9rem;cursor:pointer;font-family:inherit;display:flex;align-items:center;justify-content:center;gap:8px;transition:0.2s;margin-bottom:6px;">
                    ğ• Sign in with Twitter/X
                </button>
                <button onclick="signInWithGithub()" style="width:100%;padding:12px;background:var(--card-bg);border:1px solid var(--border);border-radius:10px;color:var(--text);font-size:0.9rem;cursor:pointer;font-family:inherit;display:flex;align-items:center;justify-content:center;gap:8px;transition:0.2s;margin-bottom:6px;">
                    <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/github.svg" width="18" height="18"> Sign in with GitHub
                </button>
                <button onclick="signInWithFacebook()" style="width:100%;padding:12px;background:var(--card-bg);border:1px solid var(--border);border-radius:10px;color:var(--text);font-size:0.9rem;cursor:pointer;font-family:inherit;display:flex;align-items:center;justify-content:center;gap:8px;transition:0.2s;margin-bottom:6px;">
                    <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/facebook.svg" width="18" height="18"> Sign in with Facebook
                </button>
<!-- Apple sign-in removed -->
            </div>
            <span class="skip" onclick="hideUsernamePrompt()">Skip for now</span>
        </div>
    </div>

    <script src="channel_index.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js" defer></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js" defer></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js" defer></script>
    <script src="ranking.js" defer></script>
    <script src="quests.js" defer></script>
    <script src="scholar.js" defer></script>
    <script src="badges.js" defer></script>
    <script>
    function openImg(src) {
        document.getElementById('lb-img').src = src;
        document.getElementById('lb').classList.add('open');
    }

    function isMobile() { return window.innerWidth <= 900; }

    function toggleTheme() {
        const isDark = document.body.getAttribute('data-theme') !== 'light';
        document.body.setAttribute('data-theme', isDark ? 'light' : 'dark');
        document.getElementById('themeBtn').textContent = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
        localStorage.setItem('btc_theme', isDark ? 'light' : 'dark');
    }
    // Restore saved theme
    (function() {
        const saved = localStorage.getItem('btc_theme');
        if (saved === 'light') {
            document.body.setAttribute('data-theme', 'light');
            setTimeout(() => { const b = document.getElementById('themeBtn'); if(b) b.textContent = 'â˜€ï¸'; }, 0);
        }
    })();

    function toggleMenu() {
        document.getElementById('sidebar').classList.toggle('open');
    }

    function getFavs() { return JSON.parse(localStorage.getItem('btc_favs') || '[]'); }
    function setFavs(f) { localStorage.setItem('btc_favs', JSON.stringify(f)); renderFavs(); }

    function toggleFav(id, btn) {
        let favs = getFavs();
        if (favs.includes(id)) {
            favs = favs.filter(f => f !== id);
            if (btn) btn.innerHTML = 'â˜† Save';
        } else {
            favs.push(id);
            if (btn) btn.innerHTML = 'â­ Saved';
        }
        setFavs(favs);
        // Sync to Firebase
        if (typeof syncFavsToFirebase === 'function') syncFavsToFirebase();
    }

    function renderFavs() {
        const favs = getFavs();
        const section = document.getElementById('favsSection');
        const list = document.getElementById('favsList');
        if (favs.length === 0) { section.style.display = 'none'; return; }
        section.style.display = 'block';
        list.innerHTML = favs.map(id => {
            const meta = CHANNELS[id];
            if (!meta) return '';
            const short = meta.title.length > 28 ? meta.title.substring(0, 28) + '...' : meta.title;
            return '<button class="ch-btn" onclick="go(\'' + id + '\',this)">â­ ' + short + '</button>';
        }).join('');
    }

    let galleryMode = false;
    let currentChannelData = null;
    let currentChannelId = null;

    function toggleGallery(id) {
        galleryMode = !galleryMode;
        const btn = document.getElementById('galleryBtn');
        if (btn) {
            btn.classList.toggle('active', galleryMode);
            btn.textContent = galleryMode ? 'ğŸ“„ List View' : 'ğŸ–¼ï¸ Gallery View';
        }
        renderContent(id);
    }

    function renderContent(id) {
        const d = currentChannelData;
        if (!d) return;
        const msgsEl = document.getElementById('msgs');

        if (galleryMode) {
            // Collect all images
            let allImgs = [];
            d.msgs.forEach(m => {
                if (m.imgs) m.imgs.forEach(img => allImgs.push(img));
            });

            let html = '<div class="gallery-grid">';
            const PAGE = 100;
            const showing = allImgs.slice(0, PAGE);
            showing.forEach(img => {
                html += '<img src="' + img + '" onclick="openImg(this.src)" loading="lazy">';
            });
            html += '</div>';
            if (allImgs.length > PAGE) {
                window._galleryImgs = allImgs;
                window._galleryOffset = PAGE;
                html += '<button class="load-more-btn" id="loadMoreGallery" onclick="loadMoreGallery()">Load more (' + (allImgs.length - PAGE) + ' remaining)</button>';
            }
            msgsEl.innerHTML = html;
        } else {
            // Normal list view - re-render
            const PAGE_SIZE = 50;
            const allMsgs = d.msgs;

            function renderBatch(startIdx) {
                const batch = allMsgs.slice(startIdx, startIdx + PAGE_SIZE);
                let html = '';
                batch.forEach(m => {
                    html += '<div class="msg">';
                    if (m.text) {
                        let t = m.text;
                        // Embed YouTube videos â€” extract them first, replace with placeholders
                        let ytEmbeds = [];
                        t = t.replace(/(?:https?:\/\/)?(?:www\.)?youtube\.com\/watch\?v=([\w-]+)(?:[&?][^\s]*)?/g, function(match, id) {
                            ytEmbeds.push(id);
                            return '%%YT' + (ytEmbeds.length - 1) + '%%';
                        });
                        t = t.replace(/(?:https?:\/\/)?youtu\.be\/([\w-]+)(?:\?[^\s]*)?/g, function(match, id) {
                            ytEmbeds.push(id);
                            return '%%YT' + (ytEmbeds.length - 1) + '%%';
                        });
                        // Now linkify remaining URLs
                        t = t.replace(/(https?:\/\/[^\s<>"]+)/g, '<a class="msg-link" href="$1" target="_blank">$1</a>');
                        // Restore YouTube embeds
                        t = t.replace(/%%YT(\d+)%%/g, function(match, idx) {
                            return '<div class="yt-embed"><iframe src="https://www.youtube-nocookie.com/embed/' + ytEmbeds[parseInt(idx)] + '" frameborder="0" allowfullscreen loading="lazy"></iframe></div>';
                        });
                        t = t.replace(/ğŸŸ  (.+)/g, '<span class="orange-glow">$1</span>');
                        html += '<div class="msg-text">' + t + '</div>';
                    }
                    if (m.imgs) m.imgs.forEach(img => {
                        html += '<img class="msg-img" src="' + img + '" onclick="openImg(this.src)" loading="lazy">';
                    });
                    html += '</div>';
                });
                return html;
            }

            let msgsHtml = renderBatch(0);
            if (allMsgs.length > PAGE_SIZE) {
                msgsHtml += '<button class="load-more-btn" id="loadMoreBtn" onclick="loadMoreMsgs()">Load more (' + (allMsgs.length - PAGE_SIZE) + ' remaining)</button>';
            }
            msgsEl.innerHTML = msgsHtml;
            window._currentMsgs = allMsgs;
            window._currentOffset = PAGE_SIZE;
        }

        // Add Next + Random buttons at the bottom
        // Use sidebar order for navigation
        if (!window._sidebarOrder) {
            window._sidebarOrder = [...document.querySelectorAll('.ch-btn')].map(b => {
                const m = b.getAttribute('onclick').match(/go\('([^']+)'/);
                return m ? m[1] : null;
            }).filter(Boolean);
        }
        const channelKeys = window._sidebarOrder.length > 0 ? window._sidebarOrder : Object.keys(CHANNELS);
        const currentIdx = channelKeys.indexOf(id);
        const nextId = currentIdx < channelKeys.length - 1 ? channelKeys[currentIdx + 1] : channelKeys[0];
        const nextTitle = CHANNELS[nextId] ? CHANNELS[nextId].title : nextId;

        const prevId = currentIdx > 0 ? channelKeys[currentIdx - 1] : channelKeys[channelKeys.length - 1];
        const prevTitle = CHANNELS[prevId] ? CHANNELS[prevId].title : prevId;

        let navHtml = '<div style="display:flex;gap:12px;justify-content:center;align-items:center;padding:30px 0 40px;border-top:1px solid var(--border);margin-top:30px;flex-wrap:wrap;">';
        navHtml += '<button onclick="go(\'' + prevId + '\')" style="padding:12px 24px;background:var(--card-bg);border:1px solid var(--border);border-radius:10px;font-size:0.95rem;font-weight:700;cursor:pointer;font-family:inherit;color:var(--text);transition:0.2s;">â† Back</button>';
        navHtml += '<button onclick="goRandom()" style="padding:12px 18px;background:var(--card-bg);border:1px solid var(--border);border-radius:10px;font-size:1.1rem;cursor:pointer;transition:0.2s;" title="Random Channel">ğŸ²</button>';
        navHtml += '<button onclick="go(\'' + nextId + '\')" style="padding:12px 24px;background:var(--accent);color:#fff;border:none;border-radius:10px;font-size:0.95rem;font-weight:700;cursor:pointer;font-family:inherit;transition:0.2s;">Next â†’</button>';
        navHtml += '</div>';
        navHtml += '<div style="text-align:center;padding-bottom:20px;">';
        navHtml += '<button onclick="if(typeof startQuestManual===\'function\')startQuestManual()" style="padding:10px 20px;background:none;border:1px solid var(--border);border-radius:10px;color:var(--text-muted);font-size:0.85rem;cursor:pointer;font-family:inherit;transition:0.2s;">âš¡ Ready to test your knowledge? Start a Quest</button>';
        navHtml += '</div>';
        msgsEl.innerHTML += navHtml;

        msgsEl.classList.add('fade-in');
    }

    function goRandom() {
        const keys = Object.keys(CHANNELS);
        const randomId = keys[Math.floor(Math.random() * keys.length)];
        go(randomId);
    }

    window.loadMoreGallery = function() {
        const imgs = window._galleryImgs;
        const offset = window._galleryOffset;
        const grid = document.querySelector('.gallery-grid');
        const btn = document.getElementById('loadMoreGallery');
        const next = imgs.slice(offset, offset + 100);

        next.forEach(img => {
            const el = document.createElement('img');
            el.src = img;
            el.loading = 'lazy';
            el.onclick = function() { openImg(this.src); };
            grid.appendChild(el);
        });

        window._galleryOffset = offset + 100;
        if (window._galleryOffset >= imgs.length) {
            btn.remove();
        } else {
            btn.textContent = 'Load more (' + (imgs.length - window._galleryOffset) + ' remaining)';
        }
    };

    function shareNostr(text, url) {
        const note = text + '\n\n' + url;
        // Copy to clipboard first
        navigator.clipboard.writeText(note).then(() => {
            showToast('ğŸ“‹ Note copied! Paste it in Primal to post.');
        }).catch(() => {});
        // Open Primal home where they can paste
        window.open('https://primal.net/home', '_blank');
    }

    function copyLink(url, btn) {
        navigator.clipboard.writeText(url).then(() => {
            btn.classList.add('copied');
            btn.textContent = 'âœ… Copied!';
            setTimeout(() => { btn.classList.remove('copied'); btn.innerHTML = 'ğŸ”— Copy Link'; }, 2000);
        });
    }

    function goRandom() {
        const keys = Object.keys(CHANNELS);
        const randomKey = keys[Math.floor(Math.random() * keys.length)];
        go(randomKey);
        if (isMobile()) document.getElementById('sidebar').classList.remove('open');
    }

    function goHome() {
        document.getElementById('home').classList.remove('hidden');
        document.getElementById('hero').innerHTML = '';
        document.getElementById('msgs').innerHTML = '';
        document.querySelectorAll('.ch-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('main').scrollTop = 0;
        history.replaceState(null, null, window.location.pathname);
        if (isMobile()) document.getElementById('sidebar').classList.remove('open');
    }

    // Cache loaded channel data
    const channelCache = {};

    async function go(id, btn) {
        const meta = CHANNELS[id];
        if (!meta) return;

        document.getElementById('home').classList.add('hidden');
        document.querySelectorAll('.ch-btn').forEach(b => b.classList.remove('active'));
        if (btn) btn.classList.add('active');

        // Show loading state
        // Check if this is an image-heavy channel
        const GALLERY_CHANNELS = ['graphics','memes-funny','art-inspiration','charts','swag-merch','fun-facts'];
        const isGallery = GALLERY_CHANNELS.includes(id);

        const shareUrl = 'https://bitcoineducation.quest/#' + id;
        const shareText = meta.title + ' â€” Bitcoin Education Archive';
        document.getElementById('hero').innerHTML =
            '<div class="cat">' + meta.cat + '</div>' +
            '<h1>' + meta.title + '</h1>' +
            '<p class="desc">' + meta.desc + '</p>' +
            '<div class="share-bar">' +
                '<a class="share-btn" href="https://twitter.com/intent/tweet?text=' + encodeURIComponent(shareText) + '&url=' + encodeURIComponent(shareUrl) + '" target="_blank">ğ• Share</a>' +
                '<button class="share-btn" onclick="shareNostr(\'' + shareText.replace(/'/g, "\\'") + '\', \'' + shareUrl + '\')">ğŸŸ£ Nostr</button>' +
                '<button class="share-btn" onclick="copyLink(\'' + shareUrl + '\', this)">ğŸ”— Copy Link</button>' +
                '<button class="share-btn" id="favBtn" onclick="toggleFav(\'' + id + '\', this)">' + (getFavs().includes(id) ? 'â­ Saved' : 'â˜† Save') + '</button>' +
            '</div>' +
            (isGallery ? '<button class="gallery-toggle" id="galleryBtn" style="display:inline-block;" onclick="toggleGallery(\'' + id + '\')">ğŸ–¼ï¸ Gallery View</button>' : '');
        document.getElementById('hero').classList.remove('fade-in');
        document.getElementById('msgs').innerHTML = '<div style="padding:40px;color:var(--text-faint);text-align:center;">Loading...</div>';
        document.getElementById('main').scrollTop = 0;
        history.replaceState(null, null, '#' + id);

        // On mobile, close the menu immediately
        if (isMobile()) {
            document.getElementById('sidebar').classList.remove('open');
        }

        // Fetch channel data (lazy load with cache)
        let d;
        if (channelCache[id]) {
            d = channelCache[id];
        } else {
            try {
                const resp = await fetch(meta.file);
                d = await resp.json();
                channelCache[id] = d;
            } catch(e) {
                document.getElementById('msgs').innerHTML = '<div style="padding:40px;color:#ef4444;">Error loading channel data</div>';
                return;
            }
        }

        // Store channel data and render
        currentChannelData = d;
        currentChannelId = id;
        galleryMode = false;
        renderContent(id);

        // Trigger fade-in animation
        document.getElementById('hero').classList.add('fade-in');
        document.getElementById('msgs').classList.add('fade-in');

        // Setup load-more for list view
        window._currentMsgs = d.msgs;
        window._currentOffset = 50;
        window.loadMoreMsgs = function() {
            const offset = window._currentOffset;
            const msgs = window._currentMsgs;
            const btn = document.getElementById('loadMoreBtn');
            const nextBatch = msgs.slice(offset, offset + 50);
            let html = '';
            nextBatch.forEach(m => {
                html += '<div class="msg">';
                if (m.text) { let t = m.text; let yt=[]; t=t.replace(/(?:https?:\/\/)?(?:www\.)?youtube\.com\/watch\?v=([\w-]+)(?:[&?][^\s]*)?/g,function(m,id){yt.push(id);return '%%YT'+(yt.length-1)+'%%';}); t=t.replace(/(?:https?:\/\/)?youtu\.be\/([\w-]+)(?:\?[^\s]*)?/g,function(m,id){yt.push(id);return '%%YT'+(yt.length-1)+'%%';}); t=t.replace(/(https?:\/\/[^\s<>"]+)/g,'<a class="msg-link" href="$1" target="_blank">$1</a>'); t=t.replace(/%%YT(\d+)%%/g,function(m,i){return '<div class="yt-embed"><iframe src="https://www.youtube-nocookie.com/embed/'+yt[parseInt(i)]+'" frameborder="0" allowfullscreen loading="lazy"></iframe></div>';}); t=t.replace(/ğŸŸ  (.+)/g,'<span class="orange-glow">$1</span>'); html += '<div class="msg-text">' + t + '</div>'; }
                if (m.imgs) m.imgs.forEach(img => { html += '<img class="msg-img" src="' + img + '" onclick="openImg(this.src)" loading="lazy">'; });
                html += '</div>';
            });
            btn.insertAdjacentHTML('beforebegin', html);
            window._currentOffset = offset + 50;
            if (window._currentOffset >= msgs.length) { btn.remove(); }
            else { btn.textContent = 'Load more (' + (msgs.length - window._currentOffset) + ' remaining)'; }
        };

        // Mark channel as visited in sidebar
        document.querySelectorAll('.ch-btn').forEach(b => {
            if (b.getAttribute('onclick') && b.getAttribute('onclick').includes("'" + id + "'")) {
                b.classList.add('visited');
            }
        });

        // Save visited channels locally
        let visited = JSON.parse(localStorage.getItem('btc_visited_channels') || '[]');
        if (!visited.includes(id)) { visited.push(id); localStorage.setItem('btc_visited_channels', JSON.stringify(visited)); }

        // Ranking: award points for opening channel
        if (typeof onChannelOpen === 'function') onChannelOpen(id);
    }

    // Search index cache for deep search
    let searchIndexLoaded = false;
    let searchFullData = {};

    async function loadSearchIndex() {
        if (searchIndexLoaded) return;
        // Load all data files in background for deep search
        const promises = Object.entries(CHANNELS).map(async ([key, meta]) => {
            if (channelCache[key]) { searchFullData[key] = channelCache[key]; return; }
            try {
                const resp = await fetch(meta.file);
                const d = await resp.json();
                channelCache[key] = d;
                searchFullData[key] = d;
            } catch(e) {}
        });
        await Promise.all(promises);
        searchIndexLoaded = true;
    }

    let searchTimeout = null;
    function doSearch(q) {
        const sr = document.getElementById('searchResults');
        const cl = document.getElementById('channelList');
        if (!q || q.length < 2) {
            sr.classList.remove('active');
            sr.innerHTML = '';
            cl.style.display = '';
            return;
        }
        q = q.toLowerCase();
        cl.style.display = 'none';
        sr.classList.add('active');

        // Instant: search channel titles from index
        let results = [];
        for (const [key, meta] of Object.entries(CHANNELS)) {
            if (meta.title.toLowerCase().includes(q) || meta.desc.toLowerCase().includes(q)) {
                results.push({key, title: meta.title, cat: meta.cat, match: 'Channel match'});
            }
        }

        renderSearchResults(results, sr);

        // Deep search: load full data and search message content (debounced)
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(async () => {
            await loadSearchIndex();
            let deepResults = [];
            for (const [key, d] of Object.entries(searchFullData)) {
                const meta = CHANNELS[key];
                if (!meta) continue;
                // Skip if already found by title
                if (results.some(r => r.key === key)) continue;
                for (const m of (d.msgs || [])) {
                    if (m.text && m.text.toLowerCase().includes(q)) {
                        let idx = m.text.toLowerCase().indexOf(q);
                        let start = Math.max(0, idx - 30);
                        let snippet = (start > 0 ? '...' : '') + m.text.substring(start, idx + q.length + 30).replace(/<[^>]+>/g, '') + '...';
                        deepResults.push({key, title: meta.title, cat: meta.cat, match: snippet});
                        break;
                    }
                }
            }
            renderSearchResults([...results, ...deepResults], sr);
        }, 500);
    }

    function renderSearchResults(results, sr) {
        if (results.length === 0) {
            sr.innerHTML = '<div style="padding:16px;color:#475569;text-align:center;">No results found</div>';
            return;
        }
        sr.innerHTML = results.slice(0, 30).map(r =>
            '<div class="sr-item" onclick="selectResult(\'' + r.key + '\')">' +
            '<div class="sr-cat">' + r.cat + '</div>' +
            '<div>' + r.title + '</div>' +
            '<div class="sr-match">' + r.match + '</div></div>'
        ).join('');
    }

    function selectResult(key) {
        document.getElementById('searchInput').value = '';
        doSearch('');
        go(key);
    }

    // Unique visit counter via Firebase
    (function() {
        const vc = document.getElementById('visitCount');
        function updateVisitDisplay() {
            if (typeof firebase === 'undefined' || !firebase.firestore) return;
            const fdb = firebase.firestore();
            const today = new Date().toISOString().split('T')[0];
            const visitorId = localStorage.getItem('btc_visitor_id') || ('v_' + Math.random().toString(36).substr(2, 12));
            localStorage.setItem('btc_visitor_id', visitorId);

            // Check if this visitor already counted today
            const visitRef = fdb.collection('visits').doc(visitorId);
            visitRef.get().then(doc => {
                if (!doc.exists || doc.data().lastVisit !== today) {
                    // New unique visit â€” increment counter and mark visitor
                    const counterRef = fdb.collection('stats').doc('visits');
                    fdb.runTransaction(t => {
                        return t.get(counterRef).then(counterDoc => {
                            const newCount = (counterDoc.exists ? counterDoc.data().total : 0) + 1;
                            t.set(counterRef, { total: newCount });
                            t.set(visitRef, { lastVisit: today });
                            return newCount;
                        });
                    }).then(newCount => {
                        vc.textContent = newCount.toLocaleString();
                    });
                } else {
                    // Already counted today â€” just display current total
                    fdb.collection('stats').doc('visits').get().then(d => {
                        if (d.exists) vc.textContent = (d.data().total || 0).toLocaleString();
                    });
                }
            }).catch(() => { vc.textContent = 'â€”'; });
        }
        // Wait a moment for Firebase to init
        setTimeout(updateVisitDisplay, 2000);
    })();

    // Suggest a topic
    function expandSuggest() {
        const fields = document.getElementById('suggestFields');
        if (fields.style.display === 'none') {
            fields.style.display = 'block';
        } else {
            fields.style.display = 'none';
        }
    }

    async function submitSuggestion() {
        const name = document.getElementById('suggestName').value.trim();
        const text = document.getElementById('suggestText').value.trim();
        const status = document.getElementById('suggestStatus');
        const btn = document.querySelector('.suggest-submit');

        if (!text) { status.innerHTML = '<span style="color:#ef4444;">Please enter a suggestion!</span>'; return; }

        btn.disabled = true;
        btn.textContent = 'Submitting...';
        try {
            if (typeof firebase !== 'undefined' && firebase.firestore) {
                await firebase.firestore().collection('suggestions').add({
                    name: name || 'Anonymous',
                    suggestion: text,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
            }
            status.innerHTML = '<span style="color:#22c55e;">âœ… Thank you! Your suggestion has been submitted.</span>';
            document.getElementById('suggestName').value = '';
            document.getElementById('suggestText').value = '';
            btn.textContent = 'Submitted!';
            setTimeout(() => { btn.textContent = 'Submit Suggestion'; btn.disabled = false; }, 3000);
        } catch(e) {
            status.innerHTML = '<span style="color:#ef4444;">Error submitting. Please try again.</span>';
            btn.textContent = 'Submit Suggestion';
            btn.disabled = false;
        }
    }

    // Daily featured channel
    (function() {
        const keys = Object.keys(CHANNELS);
        // Use day of year as seed for deterministic daily rotation
        const now = new Date();
        const dayOfYear = Math.floor((now - new Date(now.getFullYear(), 0, 0)) / 86400000);
        const dailyKey = keys[dayOfYear % keys.length];
        const ch = CHANNELS[dailyKey];
        if (ch) {
            const el = document.getElementById('dailyChannel');
            el.innerHTML = '<div class="daily-label">ğŸ“… Channel of the Day</div>' +
                '<div class="daily-title">' + ch.title + '</div>' +
                '<div class="daily-desc">' + ch.desc + '</div>';
            el.onclick = () => go(dailyKey);
        }
    })();

    // Reading progress bar + back to top
    document.getElementById('main').addEventListener('scroll', function() {
        const el = this;
        const pct = el.scrollTop / (el.scrollHeight - el.clientHeight) * 100;
        document.getElementById('progressBar').style.width = Math.min(100, Math.max(0, pct)) + '%';
        document.getElementById('backToTop').classList.toggle('visible', el.scrollTop > 400);
    });

    window.onload = () => {
        // Restore visited channel checkmarks
        const visited = JSON.parse(localStorage.getItem('btc_visited_channels') || '[]');
        visited.forEach(id => {
            document.querySelectorAll('.ch-btn').forEach(b => {
                if (b.getAttribute('onclick') && b.getAttribute('onclick').includes("'" + id + "'")) {
                    b.classList.add('visited');
                }
            });
        });

        renderFavs();

        const h = location.hash.slice(1);
        if (h) go(h);
    };
    </script>
</body>
</html>
